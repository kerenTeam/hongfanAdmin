<style type="text/css">
 #preview{
        width:150px !important;
    }
    #preview #imghead,#preview img{
     width:140px !important;
    }  
    .scrollspy-nav{
        display: inline-block;
        color:#19a7f0 !important;
    } 
    #goodsComments .am-u-sm-12{
        background:#fff;
    }
    .ampadding{
        margin-top:20px;
    } 
  .postageNumber{
        display: none;
    } 
    .addStyle{
        display: inline-block;
        padding: 3px 5px;
        border: 1px solid #1fb5ac;
        color: #1fb5ac;
        margin-left: 10px;
    }
    .addStyle:hover{
        cursor: pointer;
    }
    table tbody tr td,table thead tr th{
        font-weight: normal;
    }
    .addPropertyContent{
        margin-left: 80px;
    }
    table tbody tr{
        margin: 20px 0 !important;
    }
    .am-modal-dialog {
        width: 414px;
        height: 750px;
        overflow-y: scroll;
    }
    .bannerPic{
        width: 100%;
    }
    .good-price{
        color: #f43A44;
        font-size: 20px;
    }
    .shoplogo{
        width: 30px;
    }
    .small-word{
        color: #999;
        font-size: 14px;
        margin-top: 0;
        margin-bottom: 0;
    }
    .big-word{
        font-size: 20px;
    }
    .smallsize{
        font-size: 14px;
    }

    .good-detail{
        padding-left: 20px !important;
        padding-bottom: 10px;
    }
    .good-bd {
        border-bottom: none;
    }
    .addpadding{
        padding-top: 1.0rem;
    }
    #goodsBanner{
        position: relative;
        width: 100% !important;
        padding-top: 100%;
    }
    #goodsBanner img{
        position: absolute;
        top:0;left:0;
        width:100% !important;
        height: 100% !important;
    }
    .badgeTips{
        display: inline-block;
        padding:2px 10px !important;
        border-radius: 8px;
        background: #e0e0e0;
        font-size: 14px;
        margin-right: 10px;
    }
       #showgoodsDetail img{
        width:100%;
    }
</style>

<!-- 内容区域 -->
<div class="tpl-content-wrapper">
<div class="container-fluid am-cf">
    <div class="row">
        <div class="am-u-sm-12 am-u-md-12 am-u-lg-9">
           <div class="page-header-heading"><span class="am-icon-home page-header-heading-icon"></span>电商管理
            <a href="<?php echo site_url().'/store/Store/storeGoodsList';?>" style="font-size: 16px;">商品列表</a> 
            <small><a href="<?php echo site_url().'/store/Store/storeEditGoods';?>" style="font-size: 16px;">编辑商品详情</a></small></div>
        </div>
    </div>
</div>
<div class="row-content am-cf">
    <div class="row">
        <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
            <form class="am-form" action="<?php echo site_url('/store/Store/store_edit_goods');?>" method="post" enctype="multipart/form-data" data-am-validator>
                <div class="widget am-cf">
                    <div class="widget-head am-cf">
                        <div class="widget-title  am-cf">商品基础信息
                        <nav class="scrollspy-nav am-fr" data-am-scrollspynav="{offsetTop:60}">
                            <ul>
                                <li><a href="#goodsComments">
                            查看商品评论信息
                        </a></li>
                            </ul>
                        </nav>                     
                        </div>
                        
                    </div>
                    <div class="widget-body  am-fr">
                        <div class="memberInfo am-u-xs-12 am-u-sm-12 am-u-md-12 am-u-lg-12 padding-horizontal-lg">                   
                            <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6">
                                <label for="Name" class="am-u-sm-3 am-form-label">商品名称<span class="red">*</span>：</label>
                                <div class="am-u-sm-8">
                                    <input type="text" id="Name" value="<?php echo $goods['title'];?>" name="title" onblur="validate(this,2,50,1)" required="required" />
                                </div>
                                <small class="am-u-sm-1 red redtips1" style="display: none;"><i class="am-icon-close"></i></small>
                                <small class="am-u-sm-1 green blacktips1" style="display: none;"><i class="am-icon-check"></i></small>
                            </div> 
                            <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6">
                                <label for="englishName" class="am-u-sm-3 am-form-label">商品价格<span class="red">*</span>：</label>
                                <div class="am-u-sm-8">
                                   <input type="number" class="am-u-xs-12 am-u-sm-6 am-u-md-6 am-u-lg-6" id="goodPrice" value="<?php echo $goods['price'];?>" name="price" min="1" required="required" onblur="validate(this,2,20,2)" /> 
                                </div>
                                <small class="am-u-sm-1 red redtips2" style="display: none;"><i class="am-icon-close"></i></small>
                                <small class="am-u-sm-1 green blacktips2" style="display: none;"><i class="am-icon-check"></i></small>
                            </div>                          
                            <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6">
                                <label for="englishName" class="am-u-sm-3 am-form-label">商品品牌：</label>
                                <div class="am-u-sm-8 am-u-end">
                                    <input type="text" id="englishName"  value="<?php echo $goods['brand'];?>" name="brand"/>
                                </div>
                                
                            </div>
                            <?php $param = json_decode($goods['parameter'],true);?>
                            <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6">
                                <label for="englishName" class="am-u-sm-3 am-form-label">添加属性：</label>
                                <div class="tableContainer">
                                    <?php if(!empty($param)):?>
                                    <?php foreach($param as $v):?>
                                    <table class="addProperty">
                                        <thead>
                                            <th>属性名称</th>
                                            <th>&nbsp;</th>
                                        </thead>
                                        <tbody class="addPropertyBody">
                                            <td class="propertyName"><input type="text" value="<?php echo $v['parameter_name'];?>"></td>
                                            <td><i class="am-icon am-icon-plus addStyle createMoreName"></i></td>
                                            <table class="addPropertyContent">
                                                <thead>
                                                    <th>属性值</th>
                                                    <th>附加值</th>
                                                    <th>库存</th>
                                                    <th>&nbsp;</th>
                                                </thead>
                                                <tbody class="addPropertyTr">
                                                 <?php foreach($v['child_value'] as $child):?>
                                                    <tr class="addPropertytr">
                                                   
                                                        <td class="propertyValue"><input type="text" value="<?php echo $child['child_parameter_name'];?>" ></td>
                                                        <td class="propertyValue"><input type="text" value="<?php echo $child['equivalence'];?>"></td>
                                                        <td class="propertyValue"><input type="text" value="<?php echo $child['Inventory'];?>"></td>
                                                        <td class="propertyValue"><i class="am-icon am-icon-plus addStyle createMore1"></i></td>
                                                    
                                                    </tr>
                                                    <?php endforeach;?>
                                                </tbody>
                                            </table>
                                        </tbody>
                                    </table>
                                    <?php endforeach;?>
                                    <?php else:?>
                                    <table class="addProperty">
                                        <thead>
                                            <th>属性名称</th>
                                            <th>&nbsp;</th>
                                        </thead>
                                        <tbody class="addPropertyBody">
                                            <td class="propertyName"><input type="text" ></td>
                                            <td><i class="am-icon am-icon-plus addStyle createMoreName"></i></td>
                                            <table class="addPropertyContent">
                                                <thead>
                                                    <th>属性值</th>
                                                    <th>附加值</th>
                                                    <th>库存</th>
                                                    <th>&nbsp;</th>
                                                </thead>
                                                <tbody class="addPropertyTr">
                                                    <tr class="addPropertytr">
                                                        <td class="propertyValue"><input type="text" ></td>
                                                        <td class="propertyValue"><input type="text" ></td>
                                                        <td class="propertyValue"><input type="text" ></td>
                                                        <td class="propertyValue"><i class="am-icon am-icon-plus addStyle createMore1"></i></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </tbody>
                                    </table>
                                    <?php endif;?>
                                    <input type="hidden" name="parameter" id='inputproperty'/>
                                </div>
                                <!-- <button type="button" id="addProperty" class="am-btn-secondary am-text-center">添加</button> -->
                            </div>
                            <!-- <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6"> -->
                                <!-- <label for="goodBrand" class="am-u-sm-3 am-form-label">计量单位<span class="red">*</span>：</label>
                                <div class="am-u-sm-8 am-u-end">
                                    <input type="text" name='unit' id="unit" placeholder="例如：个、件、箱、套"  />
                                </div>
                            </div>
                            <div class="am-form-group am-u-sm-12 am-u-md-12 am-u-lg-12">
                                <label for="englishName" class="am-u-sm-1 am-form-label">添加属性：</label>
                                <div class="am-u-sm-11">
                                    <div class="am-u-sm-10 am-u-end addborder" >
                                        <input type="hidden" name="parameter" id='inputproperty'>
                                        <div class="addRule">
                                           <button type="button" class="am-btn am-btn-primary am-btn-xs" id="addNewPropertybtn">新增规格项<span class="am-icon-plus"></span> </button>
                                        </div>
                                    </div>
                                    <div class="am-u-sm-10 am-u-end addborder" >
                                        <table width="100%" id="propertyTable" class="am-table am-table-compact am-text-nowrap tpl-table-black ">
                                            <thead>
                                                <tr class="addPropertyTh">
                                                    <th class="salesPrices">销售价(元)</th>
                                                    <th class="shop_id">库存</th>
                                                </tr>
                                            </thead>
                                            <tbody class="addPropertyTb">
                                                
                                                
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div> -->
                            <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6" >
                                <label for="oneType" class="am-u-sm-3 am-form-label">是否包邮：</label>
                                <div class="am-u-sm-8 am-u-end">
                                    <input type="radio" name='postage' <?php if(empty($goods['postage'])){echo "checked";}?> id="dispostage" />是
                                    <input type="radio" id="postage" <?php if(!empty($goods['postage'])){echo "checked";}?> name='postage'/>否
                                </div>
                                
                            </div>
                            <div <?php if(!empty($goods['postage'])){echo "style='display:block;'";}else{echo "style='display:none';";}?> class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6 postageNumber" >
                                <label for="englishName" class="am-u-sm-3 am-form-label">请输入运费<span class="red">*</span>：</label>
                                <div class="am-u-sm-8">
                                    <input type="number" min="1" id="postageNum" value="<?php echo $goods['postage'];?>" name="postage" required="required" onblur="validate(this,2,20,3)"/>
                                </div>
                                <small class="am-u-sm-1 red redtips3" style="display: none;"><i class="am-icon-close"></i></small>
                                <small class="am-u-sm-1 green blacktips3" style="display: none;"><i class="am-icon-check"></i></small>
                            </div>
                            <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6">
                                <label class="am-u-sm-3 am-form-label">商品一级分类<span class="red">*</span>：</label>
                                <div class="am-u-sm-8 am-u-end">
                                    <select id="firstSort" required="required" data-am-selected="{searchBox: 1,maxHeight: 300}" name='categoryid'>
                                        <option value=''>请选择一个！</option>
                                        <?php foreach($cates as $val):?>
                                        <option value="<?php echo $val['catid'];?>" <?php if($val['catid'] == $goods['categoryid']){echo "selected";}?>><?php echo $val['catname'];?></option>
                                        <?php endforeach;?>
                                    </select>
                                </div>
                                
                            </div>
                            <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6" id="secondSort" style="display: none;">
                                <label class="am-u-sm-3 am-form-label">商品二级分类<span class="red">*</span>：</label>
                                <div class="am-u-sm-8 am-u-end">
                                    <select id="secondSortSelect" required="required" data-am-selected="{searchBox: 1,maxHeight: 200}" name='soncategoryid'>
                                    <option value=''>请选择一项...</option>
                                    </select>
                                </div>
                                
                            </div>
                            <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6">
                                <label for="oneType" class="am-u-sm-3 am-form-label">是否是推荐产品<span class="red">*</span>：</label>
                                <div class="am-u-sm-8 am-u-end">
                                    <input type="radio" name="recommend" value="1" <?php if($goods['recommend'] == "1"){echo "checked='checked'";}?> />是
                                    <input type="radio" name="recommend" value="0" <?php if($goods['recommend'] == "0"){echo "checked";}?> />否
                                </div>
                                
                            </div>
                            <input type="hidden"  id="respority" name="amount" min="1" required="required" />   
                            <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6">
                                <label for="englishName" class="am-u-sm-3 am-form-label">商品状态：<span class="red">*</span>：</label>
                                <div class="am-u-sm-8 am-u-end">
                                    <input type="radio" name="goods_state" value="1" <?php if($goods['goods_state'] == "1"){echo "checked";}?> />上架
                                    <input type="radio" name="goods_state" value="0" <?php if($goods['goods_state'] == "0"){echo "checked";}?> />下架
                                </div>
                                
                            </div>
                            <div class="am-form-group am-u-sm-12 am-u-md-6 am-u-lg-6">
                                <label for="user-weibo"  class="am-u-sm-3 am-u-end am-form-label">商品图片：</label>
                                <?php $banner = json_decode($goods['good_pic'],true);?>
                                <div class="am-u-sm-12">
                                    <div class="am-u-sm-4">
                                        <div class="wx_type_img">
                                         <input type="file" id="imgUpload" name="img1" onchange="previewImage1(this)" class="upload-add" multiple="multiple" >
                                          <!-- 图片实时预览 -->
                                          <?php if(isset($banner[0]['bannerPic'])):?>
                                          <div id="preview"> <img style="border-radius: 3px;" src="<?php echo $banner[0]['bannerPic'];?>" class="am-img-responsive cardView"> </div>
                                           <input type="hidden" name="img1" value="<?php echo $banner[0]['bannerPic'];?>">
                                            <?php else:?>
                                                 <div id="preview"> <img style="border-radius: 3px;" src="assets/img/nullImg.jpg" class="am-img-responsive cardView"> </div>
                                            <?php endif;?>
                                        </div>
                                        <span class="deleteImg"><i class="am-icon-trash"></i> 删除</span> 
                                    </div>
                                    <div class="am-u-sm-4">
                                        <div class="wx_type_img">
                                         <input type="file" id="imgUpload" name="img2" onchange="previewImage(this)" class="upload-add" multiple="multiple" >
                                          <!-- 图片实时预览 -->
                                          <?php if(isset($banner[1]['bannerPic'])):?>
                                          <div id="preview"> <img style="border-radius: 3px;" src="<?php echo $banner[1]['bannerPic'];?>" class="am-img-responsive cardView"> </div>
                                           <input type="hidden" name="img2" value="<?php echo $banner[1]['bannerPic'];?>">
                                            <?php else:?>
                                                 <div id="preview"> <img style="border-radius: 3px;" src="assets/img/nullImg.jpg" class="am-img-responsive cardView"> </div>
                                            <?php endif;?>
                                        </div>
                                        <span class="deleteImg"><i class="am-icon-trash"></i> 删除</span> 
                                    </div>
                                    <div class="am-u-sm-4">
                                        <div class="wx_type_img">
                                         <input type="file" id="imgUpload" name="img3" onchange="previewImage(this)" class="upload-add" multiple="multiple">
                                          <!-- 图片实时预览 -->
                                          <?php if(isset($banner[2]['bannerPic'])):?>
                                          <div id="preview"> <img style="border-radius: 3px;" src="<?php echo $banner[2]['bannerPic'];?>" class="am-img-responsive cardView"> </div>
                                          <input type="hidden" name="img3" value="<?php echo $banner[2]['bannerPic'];?>">
                                            <?php else:?>
                                                 <div id="preview"> <img style="border-radius: 3px;" src="assets/img/nullImg.jpg" class="am-img-responsive cardView"> </div>
                                            <?php endif;?>
                                        </div>
                                        <span class="deleteImg"><i class="am-icon-trash"></i> 删除</span> 
                                    </div>
                                </div>
                                <div class="red am-text-center father">        
                                  <small class="tpl-form-line-small-title">提示：图片格式支持：PNG、JPG、JPEG；不超过三张，最大支持2M</small> 
                              </div> 
                            </div> 
                        </div>
                        <div class="am-form-group am-u-sm-12 am-u-md-12 am-u-lg-12">
                            <label for="englishName" class="am-u-sm-1 am-form-label">商品详情<span class="red">*</span>：</label>
                            <div class="am-u-sm-10 am-u-end">
                                <div style="overflow-y: scroll;height:400px;">
                                    <script id="editor" type="text/plain" name='content'><?php echo $goods['content'];?></script>
                                </div>
                            </div>                          
                        </div>          
                    </div>
                    
                </div>
                
                <div class="am-form-group am-text-center">
                    <input type="hidden" name="goods_id" value="<?php echo $goods['goods_id'];?>">
                        <a data-am-modal="{target: '#goodMessage'}" id="eyeDetail" class="am-btn am-btn-default am-btn-warning"><span class="am-icon-eye"></span> 点击预览</a>
                        <button class="am-btn am-btn-secondary" type="submit" id="addProperty">提交</button>
                        <button class="am-btn am-btn-default" type="reset" id="cancle">取消</button> 
                </div>
            </form>
        </div>
    </div>
</div>
</div>
<div class="goTop"><a href="javascript:scroll(0,0)" type="button"><img src="assets/img/top.png" alt="点我回到顶部"></a></div>
<!-- 预览开始 -->
<div class="am-modal am-modal-prompt" tabindex="-1" id="goodMessage">
    <div class="am-modal-dialog">
        <div class="am-modal-hd">移动端商品预览(仅展示)</div>
        <div class="am-modal-bd good-bd">
            <div class="goodBanner" id="goodsBanner">
             <!-- <?php $banner = json_decode($goods['good_pic'],true);?> -->
                <?php foreach($banner as $v):?>
                    <img src="<?php echo $v['bannerPic'];?>">
                <?php endforeach;?>
            </div>
            <div class="goodBanner am-u-lg-12 am-u-sm-12 am-u-md-12 am-text-left addpadding">
                <div class="am-u-lg-10 am-u-sm-10 am-u-md-10" id="showgoodsname"><?php echo $goods['title'];?></div>
                <div class="am-u-lg-2 am-u-sm-2 am-u-md-2 am-text-center" style="border-left: 1px solid #ccc;">
                    <img src="assets/img/shangjia.png" class="shoplogo" />
                    <p class="small-word">商家</p>
                </div>
            </div>
            <div class="goodBanner am-u-lg-12 am-u-sm-12 am-u-md-12 am-text-left good-price">
                <div class="am-u-lg-4 am-u-sm-4 am-u-md-4" id="showgoodsprice">￥ <?php echo $goods['price'];?></div>
            </div>
            <div class="goodBanner am-u-lg-12 am-u-sm-12 am-u-md-12 am-text-left">
                <div class="am-u-lg-4 am-u-sm-4 am-u-md-4 small-word" id="showgoodspostage">快递：<?php echo $goods['postage'];?></div>
                <div class="am-u-lg-4 am-u-sm-4 am-u-md-4 small-word">
                    销量：<?php echo $goods['sales'];?>笔
                </div>
                <div class="am-u-lg-4 am-u-sm-4 am-u-md-4 small-word" id="showgoodsresporty">
                    库存：100件
                </div>
            </div>
            <div id="showproporty" class="am-u-lg-12 am-u-sm-12 am-u-md-12 am-text-left">
                
            </div>
            <div class="goodBanner am-u-lg-12 am-u-sm-12 am-u-md-12 am-text-left good-detail">
                <p class="big-word">商品详情</p>
                <article class="smallsize" id="showgoodsDetail">
                   <?php echo $goods['content'];?>
                </article>
            </div>
        </div>
        <div class="am-modal-footer">
            <span class="am-modal-btn" data-am-modal-cancle>取消</span>
            <span class="am-modal-btn" data-am-modal-confirm>确定</span>
        </div>
    </div>
</div>
<!-- 预览结束 -->
<script type="text/javascript" charset="utf-8" src="assets/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="assets/ueditor/ueditor.all.min.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="assets/ueditor/lang/zh-cn/zh-cn.js"></script>
</body>
<script type="text/javascript">
//表单验证函数
function validate(obj,minlen,maxlen,i){
    var content=obj.value;
    if(content.length<minlen || content.length>maxlen){
        $('.blacktips'+ i).css('display','none');
        $('.redtips'+ i).css('display','inline-block');
    }else{
        $('.redtips'+ i).css('display','none');
        $('.blacktips'+ i).css('display','inline-block');
    }
}

  $(function() {
    var startDate = new Date(2014, 11, 20);
    var endDate = new Date(2014, 11, 25);
    var $alert = $('#my-alert');
    $('#my-start').datepicker().
      on('changeDate.datepicker.amui', function(event) {
        if (event.date.valueOf() > endDate.valueOf()) {
          $alert.find('p').text('开始日期应小于结束日期！').end().show();
        } else {
          $alert.hide();
          startDate = new Date(event.date);
          $('#my-startDate').text($('#my-start').data('date'));
        }
        $(this).datepicker('close');
      });

    $('#my-end').datepicker().
      on('changeDate.datepicker.amui', function(event) {
        if (event.date.valueOf() < startDate.valueOf()) {
          $alert.find('p').text('结束日期应大于开始日期！').end().show();
        } else {
          $alert.hide();
          endDate = new Date(event.date);
          $('#my-endDate').text($('#my-end').data('date'));
        }
        $(this).datepicker('close');
      });
  });
    //删除图片
    $(".deleteImg").click(function(){
        $(this).siblings('.wx_type_img').find('img').attr('src','assets/img/nullImg.jpg');
        $(this).siblings('.wx_type_img').find('input').val("");
        $(this).siblings('.wx_type_img').find('input').files="";
    });
    //点击取消返回上一页
  $('#cancle').click(function(){
    history.go(-1);
  });

 //点击进行运费设置
$('#postage').click(function(){
    $('.postageNumber').css('display','block');

});
//点击取消运费设置
$('#dispostage').click(function(){
    $('.postageNumber').css('display','none');
});
  //点击预览商品详情
  $('#eyeDetail').click(function() {
    document.getElementById('showproporty').innerHTML="";
    var totalrespority=0,addPropertytdcopy=[];
    var stand1=$('#ruleSelect0 option:selected').val(),stand2=$('#ruleSelect1 option:selected').val(),stand3=$('#ruleSelect2 option:selected').val(),stand4=$('#ruleSelect3 option:selected').val();
    for(var i=0;i<$('.ruleSelect').length;i++) {
        if($('#ruleSelect'+i+' option:selected').val()!=""){
            var addPropertytdco={};
            addPropertytdco.stend=$('#ruleSelect'+i+' option:selected').html();
            // console.log(addPropertytdco = addPropertytdco.stend);
            addPropertytdco.stend_value=[];
            var daiti=$('.propertycontainer'+ i);
            for(var j=0;j<daiti.find('span').length;j++){
                var addPropertyc={};
                addPropertyc.stend_value=daiti.find('span').eq(j).text();
                addPropertytdco.stend_value.push(addPropertyc);
            }
        }
        addPropertytdcopy.push(addPropertytdco);
    }
    addPropertytdcopy.addPropertytdcopy=addPropertytdcopy;
    var html = template("showproportyModal",{addPropertytdcopy:addPropertytdcopy});
    document.getElementById('showproporty').innerHTML = html;

    var picSrc=$('#goodsBanner').html();
    var goodName=$('#goodName').val();
    var goodPrice=$('#goodPrice').val();
    var postage=document.getElementById('dispostage').checked,postageNum=$('#postageNum').val();
    var dispostage=$('#dispostage').attr('checked');
    var editorContent= UE.getEditor('editor').getContent();
    $('#showgoodsname').html(goodName);
    $('#showgoodsprice').html('￥'+goodPrice);
    $('#showgoodsresporty').html('库存：'+totalrespority);
    if(postage){
        $('#showgoodspostage').html("快递：免邮");
    }else{
        $('#showgoodspostage').html("运费："+ postageNum +"元");
    }
    $('#showgoodsDetail').html(editorContent);

  });

    //实例化编辑器
    var ue = UE.getEditor('editor'),firstFlag=1,secondFlag=1; 
    function showfun(obj) {
        $(obj).parents('.chooseSelectPart').find('.addNewPropertv').css('display','block');
    }
    function showBtn(obj){
        var kk=$(obj).attr('data-id') ;
        if($(this).find('option:selected').val()=="") {
            alert("请选择合法的规格项");
            return false; 
        }else{

            $(obj).siblings().css('display','block');
            console.log($('#propertycontainer'+kk).find('span'));
            $('.propertycontainer'+kk).find('span.badgePro').remove();
            // property=$(obj).find('option:selected').html();
            $('.addPropertyName').remove();
            $('.addPropertyTb').find('tr').remove();
            updateTable (); 
            return true;
        }
    }
    function deleteProValue(obj){
        $(obj).parent('.badgePro').remove();
        $('.addPropertyName').remove();
        $('.addPropertyTb').find('tr').remove();
        updateTable (); 
    }
    function showPropertyValue(obj) {
        var sureAddNewPropert=$(obj).parents('.addNewPropertv').find('.addNewPropertValue').val(),kk=$(obj).attr('data-id');
        // console.log(kk);  
        $('.propertycontainer'+kk).append('<span class="badgePro">'+ sureAddNewPropert +'<i class="am-icon am-icon-close spanIcon" onclick="deleteProValue(this)"></i></span>')
        $('.addPropertyName').remove();
        $('.addPropertyTb').find('tr').remove();
        $(obj).parents('.addNewPropertv').css('display','none'); 
        $(obj).parents('.addNewPropertv').find('.addNewPropertValue').val("");      
        updateTable ();   
        
    }



    //更新表格内容的js函数
    function updateTable () {
        var lenpro0=$('.propertycontainer0').find('span').length,lenpro1=$('.propertycontainer1').find('span').length,lenpro2=$('.propertycontainer2').find('span').length,lenpro3=$('.propertycontainer3').find('span').length;
        console.log(lenpro3+"  "+lenpro2+"  "+lenpro1+"  "+lenpro0);
        if(lenpro0 && !lenpro1 && !lenpro2 && !lenpro3) {
            var property0=$('#ruleSelect0 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName0">'+ property0+'</th>');
            for(var i=0;i<lenpro0;i++){
                var propertyValue0=$('.propertycontainer0').find('span').eq(i).text();
                $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property0">'+ propertyValue0 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
            }
        }
        if(!lenpro0 && lenpro1 && !lenpro2 && !lenpro3) {
            var property1=$('#ruleSelect1 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName1">'+ property1+'</th>');
            for(var i=0;i<lenpro1;i++){
                var propertyValue1=$('.propertycontainer1').find('span').eq(i).text();
                $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property1">'+ propertyValue1 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
            }
            return true;
        }else if(!lenpro0 && !lenpro1 && lenpro2 && !lenpro3) {
            var property2=$('#ruleSelect2 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName2">'+ property2+'</th>');
            for(var i=0;i<lenpro2;i++){
                var propertyValue2=$('.propertycontainer2').find('span').eq(i).text();
                $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property2">'+ propertyValue2 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
            }
            return true;
        }else if(!lenpro0 && !lenpro1 && !lenpro2 && lenpro3) {
            var property3=$('#ruleSelect3 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName3">'+ property3 +'</th>');
            for(var i=0;i<lenpro3;i++){
                var propertyValue3=$('.propertycontainer3').find('span').eq(i).text();
                $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property3">'+ propertyValue3 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
            }
            return true;
        }else if(lenpro0 && lenpro1 && !lenpro2 && !lenpro3){
            var property1=$('#ruleSelect1 option:selected').html(),property0=$('#ruleSelect0 option:selected').html();
            console.log(property1);
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName1">'+ property1+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName0">'+ property0+'</th>');
            for(var i=0;i<lenpro1;i++){
                var propertyValue1=$('.propertycontainer1').find('span').eq(i).text();
                for(var j=0;j<lenpro0;j++){
                    var propertyValue0=$('.propertycontainer0').find('span').eq(j).text();
                    $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property0">'+ propertyValue0 +'</td><td class="am-text-middle property" id="property1">'+ propertyValue1 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                }
            }
            return true;
        }else if(lenpro0 && !lenpro1 && lenpro2 && !lenpro3){
            var property2=$('#ruleSelect2 option:selected').html(),property0=$('#ruleSelect0 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName2">'+ property2+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName0">'+ property0+'</th>');
            for(var i=0;i<lenpro2;i++){
                var propertyValue2=$('.propertycontainer2').find('span').eq(i).text();
                for(var j=0;j<lenpro0;j++){
                    var propertyValue0=$('.propertycontainer0').find('span').eq(j).text();
                    $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property0">'+ propertyValue0 +'</td><td class="am-text-middle property" id="property2">'+ propertyValue2 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                }
            }
            return true;
        }else if(lenpro0 && !lenpro1 && !lenpro2 && lenpro3) {
            var property3=$('#ruleSelect3 option:selected').html(),property0=$('#ruleSelect0 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName3">'+ property3+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName0">'+ property0+'</th>');
            for(var i=0;i<lenpro3;i++){
                var propertyValue3=$('.propertycontainer3').find('span').eq(i).text();
                for(var j=0;j<lenpro0;j++){
                    var propertyValue0=$('.propertycontainer0').find('span').eq(j).text();
                    $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property0">'+ propertyValue0 +'</td><td class="am-text-middle property" id="property3">'+ propertyValue3 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                }
            }
            return true; 
        }else if(!lenpro0 && lenpro1 && lenpro2 && !lenpro3) {
            var property2=$('#ruleSelect2 option:selected').html(),property1=$('#ruleSelect1 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName2">'+ property2+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName1">'+ property1+'</th>');
            for(var i=0;i<lenpro2;i++){
                var propertyValue2=$('.propertycontainer2').find('span').eq(i).text();
                for(var j=0;j<lenpro1;j++){
                    var propertyValue1=$('.propertycontainer1').find('span').eq(j).text();
                    $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property1">'+ propertyValue1 +'</td><td class="am-text-middle property" id="property2">'+ propertyValue2 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                }
            }
            return true; 
        }else if(!lenpro0 && lenpro1 && !lenpro2 && lenpro3) {
            var property3=$('#ruleSelect3 option:selected').html(),property1=$('#ruleSelect1 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName3">'+ property3+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName1">'+ property1+'</th>');
            for(var i=0;i<lenpro3;i++){
                var propertyValue3=$('.propertycontainer3').find('span').eq(i).text();
                for(var j=0;j<lenpro1;j++){
                    var propertyValue1=$('.propertycontainer1').find('span').eq(j).text();
                    $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property1">'+ propertyValue1 +'</td><td class="am-text-middle property" id="property3">'+ propertyValue3 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                }
            }
            return true; 
        }else if(!lenpro0 && !lenpro1 && lenpro2 && lenpro3) {
            var property3=$('#ruleSelect3 option:selected').html(),property2=$('#ruleSelect2 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName3">'+ property3+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName2">'+ property2+'</th>');
            for(var i=0;i<lenpro3;i++){
                var propertyValue3=$('.propertycontainer3').find('span').eq(i).text();
                for(var j=0;j<lenpro2;j++){
                    var propertyValue2=$('.propertycontainer2').find('span').eq(j).text();
                    $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property2">'+ propertyValue2 +'</td><td class="am-text-middle property" id="property3">'+ propertyValue3 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                }
            }
            return true;
        }else if(lenpro0 && lenpro1 && lenpro2 && !lenpro3) {
            var property2=$('#ruleSelect2 option:selected').html(),property1=$('#ruleSelect1 option:selected').html(),property0=$('#ruleSelect0 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName2">'+ property2+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName1">'+ property1+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName0">'+ property0+'</th>');
            for(var k=0;k<lenpro2;k++){
                var propertyValue2=$('.propertycontainer2').find('span').eq(k).text();
                for(var i=0;i<lenpro1;i++){
                    var propertyValue1=$('.propertycontainer1').find('span').eq(i).text();
                    for(var j=0;j<lenpro0;j++){
                        var propertyValue0=$('.propertycontainer0').find('span').eq(j).text();
                        $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property0">'+ propertyValue0 +'</td><td class="am-text-middle property" id="property1">'+ propertyValue1 +'</td><td class="am-text-middle property" id="property2">'+ propertyValue2 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                    }
                }
            }
            return true;
        }else if(lenpro0 && lenpro1 && !lenpro2 && lenpro3) {
            var property3=$('#ruleSelect3 option:selected').html(),property1=$('#ruleSelect1 option:selected').html(),property0=$('#ruleSelect0 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName3">'+ property3+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName1">'+ property1+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName0">'+ property0+'</th>');
            for(var k=0;k<lenpro3;k++){
                var propertyValue3=$('.propertycontainer3').find('span').eq(k).text();
                for(var i=0;i<lenpro1;i++){
                    var propertyValue1=$('.propertycontainer1').find('span').eq(i).text();
                    for(var j=0;j<lenpro0;j++){
                        var propertyValue0=$('.propertycontainer0').find('span').eq(j).text();
                        $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property0">'+ propertyValue0 +'</td><td class="am-text-middle property" id="property1">'+ propertyValue1 +'</td><td class="am-text-middle property" id="property3">'+ propertyValue3 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                    }
                }
            }
            return true;
        }else if(lenpro0 && !lenpro1 && lenpro2 && lenpro3) {
            var property3=$('#ruleSelect3 option:selected').html(),property2=$('#ruleSelect2 option:selected').html(),property0=$('#ruleSelect0 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName3">'+ property3+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName2">'+ property2+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName0">'+ property0+'</th>');
            for(var k=0;k<lenpro3;k++){
                var propertyValue3=$('.propertycontainer3').find('span').eq(k).text();
                for(var i=0;i<lenpro2;i++){
                    var propertyValue2=$('.propertycontainer2').find('span').eq(i).text();
                    for(var j=0;j<lenpro0;j++){
                        var propertyValue0=$('.propertycontainer0').find('span').eq(j).text();
                        $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property0">'+ propertyValue0 +'</td><td class="am-text-middle property" id="property2">'+ propertyValue2 +'</td><td class="am-text-middle property" id="property3">'+ propertyValue3 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                    }
                }
            }
            return true;
        }else if(!lenpro0 && lenpro1 && lenpro2 && lenpro3) {
            var property3=$('#ruleSelect3 option:selected').html(),property2=$('#ruleSelect2 option:selected').html(),property1=$('#ruleSelect1 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName3">'+ property3+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName2">'+ property2+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName1">'+ property1+'</th>');
            for(var k=0;k<lenpro3;k++){
                var propertyValue3=$('.propertycontainer3').find('span').eq(k).text();
                for(var i=0;i<lenpro2;i++){
                    var propertyValue2=$('.propertycontainer2').find('span').eq(i).text();
                    for(var j=0;j<lenpro1;j++){
                        var propertyValue1=$('.propertycontainer1').find('span').eq(j).text();
                        $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property1">'+ propertyValue1 +'</td><td class="am-text-middle property" id="property2">'+ propertyValue2 +'</td><td class="am-text-middle property" id="property3">'+ propertyValue3 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                    }
                }
            }
            return true;
        }else if(lenpro0 && lenpro1 && lenpro2 && lenpro3) {
            var property1=$('#ruleSelect1 option:selected').html(),property3=$('#ruleSelect3 option:selected').html(),property2=$('#ruleSelect2 option:selected').html(),property0=$('#ruleSelect0 option:selected').html();
            $('.addPropertyTh').prepend('<th class="addPropertyName" id="addPropertyName3">'+ property3+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName2">'+ property2+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName1">'+ property1+'</th>');
            $('.addPropertyName').eq('0').before('<th class="addPropertyName" id="addPropertyName0">'+ property0+'</th>');

            for(var hhd=0;hhd<lenpro3;hhd++){
                var propertyValue3=$('.propertycontainer3').find('span').eq(hhd).text();
                for(var k=0;k<lenpro2;k++){
                    var propertyValue2=$('.propertycontainer2').find('span').eq(k).text();
                    for(var i=0;i<lenpro1;i++){
                        var propertyValue1=$('.propertycontainer1').find('span').eq(i).text();
                        for(var j=0;j<lenpro0;j++){
                            var propertyValue0=$('.propertycontainer0').find('span').eq(j).text();
                            $('.addPropertyTb').append('<tr class="addPropertyTr"><td class="am-text-middle property" id="property0">'+ propertyValue0 +'</td><td class="am-text-middle property" id="property1">'+ propertyValue1 +'</td><td class="am-text-middle property" id="property2">'+ propertyValue2 +'</td><td class="am-text-middle property" id="property3">'+ propertyValue3 +'</td><td class="propertyprice">3000</td><td class="propertystock">400</td></tr>');
                        }
                    }
                }
            }
            return true;
        }
    } 
    //新增规格项
    $('#addNewPropertybtn').click(function () {
        if(kflag==4){
            alert("最多只能录入四个属性");
            return false;
        }else{
            $('.addRule').before('<div class="chooseSelectPart" id="chooseSelectPart'+ kflag +'" ><div class="am-u-sm-12 selectList" style="clear:both;margin-bottom:10px;"><select id="ruleSelect'+ kflag +'" data-id="'+ kflag +'" class="ruleSelect" data-am-selected="{searchBox: 1,maxHeight: 800}" name="ruleSelect" onchange="showBtn(this)"><option value="">请选择一个！</option><option value="0">尺寸</option><option value="1">包装</option><option value="2">版本</option><option value="3">套餐</option><option value="4">内存</option><option value="5">容量</option><option value="6">净含量</option><option value="7">口味</option></select><div class="propertycontainer'+kflag+'"></div><a type="button" class="am-btn am-btn-primary am-btn-xs newpropertyvbtn" onclick="showfun(this)" id="newpropertyvbtn'+ kflag +'" style="display:none;" >新增规格值<span class="am-icon-plus"></span> </a></div><div class="am-u-sm-12 addNewPropertv" id="addNewPropertv'+ kflag +'" style="display:none;"><div class="am-u-sm-6 am-u-end" style="margin-left:-10px;margin-bottom:10px;"><input type="text" id="addNewPropertValue'+ kflag +'" class="addNewPropertValue" name="addNewPropertValue" /></div><button class="am-u-sm-1 am-u-end am-btn am-btn-warning am-btn-xs sureAddNewPropert" data-id="'+kflag+'" type="button" id="sureAddNewPropert'+ kflag +'" onclick="showPropertyValue(this)">确定</button><button class="am-u-sm-1 am-u-end am-btn am-btn-default am-btn-xs">取消</button></div></div>');
                $('.addNewPropertv').css('display','none');
                kflag++;
                return true;    
        }
    });
    //添加属性
    $('#addProperty').click(function(){
        var propertyArray=[],totalrespority=0,stend1=$('#addPropertyName0').text(),stend2=$('#addPropertyName1').text(),stend3=$('#addPropertyName2').text(),stend4=$('#addPropertyName3').text();
            
        for(var i=0;i<$('.addPropertyTr').length;i++){ 
            var value1=$('.addPropertyTr').eq(i).find('.property').eq('0').text(),value2=$('.addPropertyTr').eq(i).find('.property').eq('1').text(),value3=$('.addPropertyTr').eq(i).find('.property').eq('2').text(),value4=$('.addPropertyTr').eq(i).find('.property').eq('3').text();
            var price=$('.addPropertyTr').eq(i).find('.propertyprice').text();
            var stock=$('.addPropertyTr').eq(i).find('.propertystock').text();
            var addPropertytd={};
            addPropertytd.stend1=stend1;
            addPropertytd.stend2=stend2;
            addPropertytd.stend3=stend3;
            addPropertytd.stend4=stend4;
            addPropertytd.value1=value1;
            addPropertytd.value2=value2;
            addPropertytd.value3=value3;
            addPropertytd.value4=value4;
            addPropertytd.price=price;
            addPropertytd.stock=stock;

            totalrespority+=parseInt(addPropertytd.stock);
            propertyArray.push(addPropertytd);
            
        }
        $('#inputproperty').val(JSON.stringify(propertyArray));
    });


    $(document).ready(function(){
        //根据一级业态的内容来控制二级业态的显示
        var firstSort=$('#firstSort option:selected').val(),str='',sttr='<option value="">请选择一项...</option>';
        var soncateid = '<?php echo $goods['soncategoryid'];?>';
        $.ajax({
            type:'post',
            url:'<?php echo site_url('shop/SingleShop/return_godos_cate');?>',
            data: 'catid='+ firstSort,
            success: function(data){   
                var jsonData=eval(data);
                // console.log(jsonData);
                if(data!="2"){   
                    for(var i=0;i<jsonData.length;i++){
                      if(jsonData[i].catid==soncateid){
                        str='<option selected value="'+ jsonData[i].catid +'">' + jsonData[i].catname + '</option>';  
                      }else{
                        str='<option  value="'+ jsonData[i].catid +'">' + jsonData[i].catname + '</option>';
                      }
                        
                        sttr=sttr+str;
                    }
                    console.log(sttr);
                    $('#secondSort').css('display','block');
                    $("#secondSortSelect").append(sttr);
                }else{
                    $('#secondSort').css('display','block');
                }
                
            },
            error:function(xhr,type,errorThrown){
                alert("操作失败，请检查网络设置！");
            }
        });


         $('#firstSort').change(function(){
            //根据一级业态的内容来控制二级业态的显示
            var firstSort=$('#firstSort option:selected').val(),str='',sttr='<option value="">请选择一项...</option>';
            $.ajax({
                type:'post',
                url:'<?php echo site_url('shop/SingleShop/return_godos_cate');?>',
                data: 'catid='+ firstSort,
                success: function(data){ 
                    $("#secondSortSelect").html("");  
                    var jsonData=eval(data);
                    console.log(jsonData);
                    console.log(soncateid);
                    if(data!="2"){   
                    for(var i=0;i<jsonData.length;i++){
                      if(jsonData[i].catid==soncateid){
                        str='<option selected value="'+ jsonData[i].catid +'">' + jsonData[i].catname + '</option>';  
                      }else{
                        str='<option  value="'+ jsonData[i].catid +'">' + jsonData[i].catname + '</option>';
                      }
                        
                        sttr=sttr+str;
                    }
                    console.log(sttr);
                    $('#secondSort').css('display','block');
                    $("#secondSortSelect").append(sttr);
                }else{
                    $('#secondSort').css('display','block');
                }
                    
                },
                error:function(xhr,type,errorThrown){
                    alert("操作失败，请检查网络设置！");
                }
            });
        });
    });


    //图片预览的商品图片
function previewImage1(file) {
  var MAXWIDTH = 350;
  var MAXHEIGHT = 249;
  //var div = document.getElementById('preview');
  var div = findPreview(file.parentNode);
  var div1 = document.getElementById('goodsBanner');
  if (file.files && file.files[0]) {
    div.innerHTML = '<img id=imghead>';
    div1.innerHTML = '<img >';
    //var img = document.getElementById('imghead');
    var img = div.lastChild,img1=div1.lastChild;
    img.onload = function() {
      var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
      img.width = rect.width;
      img.height = rect.height;
    }
    img1.onload = function() {
      var rect1 = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
      img1.width = rect1.width;
      img1.height = rect1.height;
    }
    var reader = new FileReader();
    reader.onload = function(evt) {
      img.src = evt.target.result;
      img1.src = evt.target.result;
    }
    
    reader.readAsDataURL(file.files[0]);
  } else //鍏煎IE
  {
    //alert("123");
    var sFilter = 'filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
    file.select();
    var src = document.selection.createRange().text;
    div.innerHTML = '<img id=imghead>';
    div1.innerHTML = '<img id=imghead>';
    //var img = document.getElementById('imghead');
    var img = div.lastChild;
    img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
    var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
    status = ('rect:' + rect.top + ',' + rect.left + ',' + rect.width + ',' + rect.height);
    var img1 = div1.lastChild;
    img1.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
    var rect1 = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img1.offsetWidth, img1.offsetHeight);
    status1 = ('rect:' + rect1.top + ',' + rect1.left + ',' + rect1.width + ',' + rect1.height);
    div.innerHTML = "<div id=divhead style='width:" + rect.width + "px;height:" + rect.height + "px;margin-top:" + rect.top + "px;" + sFilter + src + "\"'></div>";
    div1.innerHTML = "<div id=divhead style='width:" + rect1.width + "px;height:" + rect1.height + "px;margin-top:" + rect1.top + "px;" + sFilter + src + "\"'></div>";
  }
}


</script>
<script type="text/html" id="showproportyModal">
<%for(var i=0;i<addPropertytdcopy.length;i++) {%>
    <div>
        <p class="big-word1"><%= addPropertytdcopy[i].stend%></p>
        <p>
        <%for(var j=0;j<addPropertytdcopy[i].stend_value.length;j++) {%>
            <span class="badgeTips"><%= addPropertytdcopy[i].stend_value[j].stend_value%></span>
        <%}%>
        </p>
    </div>
<%}%>
</script>