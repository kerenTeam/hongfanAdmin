 

<style type="text/css" media="screen">

    .am-selected {

        width: 100%!important;

    }

    .table-check {

        width: 30px;

    }  

    .hf-dropdown {

        font-size: 12px!important;

        padding: 5px 6px!important;

    } 

    td.am-text-middle img {

        width:80px;

    }

    .am-u-sm6{

        width:50px !important;

        margin:0;

    } 

    .am-form-group div {

        line-height: 37px;

    }   

    .stable {

        display: inline-block !important;

        width: 45% !important;

    }

    .linkWord {

        width: 10% !important;

    }



    .goodsState,.recommend,.goodsSelect, .priceState {

        width: 80px;

        background: #15b5ac;

        border-radius: 5px;

        border: 1px solid #15b5ac;

        padding:5px 5px;

        color: #fff;

        text-align: center;

    }

    .goodsSelect {

        width: 120px;

        padding:0 5px;

        border-radius: 0;

        height: 28px;

        font-size:14px;

    }

    .goodsState option,.recommend option,.priceState option,.goodsSelect option{

        background: #fff;

        border-radius: 5px;

        border: 1px solid #aaa;

        padding:2px 5px;

        color: #000;

        text-align: center;

    } 

    .goodsState option[selected="selected"],.recommend option[selected="selected"],.priceState option[selected="selected"],.goodsSelect option[selected="selected"] {

        background: #15b5ac;

        border:1px solid #15b5ac;

    }

    .goodsSelectDiv {

        margin-top: -7px;

    }

    table tbody tr td:nth-child(5) {

        max-width: 300px;

        white-space: normal;

    }

    .am-icon-sort {

        cursor: pointer;

    }

    .editPrice {

        border:1px solid #e0690c !important;

        padding:5px 6px !important;

        color: #e0690c !important;

    }

</style>


<!-- 新分页开始 -->
<style>
    .page_div {margin-top: 20px;margin-bottom: 20px;font-size: 15px;font-family: "microsoft yahei";color: #666666;margin-right: 10px;padding-left: 20px;box-sizing: border-box;text-align: center;-moz-user-select:none;-webkit-user-select:none;}
    .page_div a {min-width: 32px;height: 40px;border: 1px solid #dce0e0!important;text-align: center;margin: 0 4px;cursor: pointer;line-height: 40px;color: #666666;font-size: 13px;display: inline-block;}
    #firstPage,#lastPage {width: 50px;color: #1fb5ac;border: 1px solid #1fb5ac!important;}
    #prePage, #nextPage {width: 70px;color: #1fb5ac;border: 1px solid #1fb5ac!important;}
    .page_div .current {background-color: #1fb5ac;border-color: #1fb5ac;color: #FFFFFF;}
    .totalPages {margin: 0 10px;}
    .totalPages span, .totalSize span {color: #1fb5ac;margin: 0 5px;}
</style>
<script src="assets/js/pagingY.js"></script> 

<!-- 内容区域 -->

<div class="tpl-content-wrapper">

<div class="container-fluid am-cf">

    <div class="row">

        <div class="am-u-sm-12 am-u-md-12 am-u-lg-9">

            <div class="page-header-heading"><span class="am-icon-home page-header-heading-icon"></span>商城管理 &nbsp;&nbsp;<a href="<?php echo site_url().'/store/store/storeGoodsList';?>" style="font-size:16px;">商品列表</a>

            </div>

        </div>

    </div>

</div>

<div class="row-content am-cf">

    <div class="row">

        <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">

            <div class="widget am-cf">

                <div class="widget-head am-cf">

                    <div class="widget-title  am-cf">商品搜索</div>

                </div>

                <form class="am-form am-form-horizontal am-padding-sm am-text-sm" enctype="multipart/form-data">

                    <div class="am-form-group am-inline am-u-sm-4 am-u-md-4 am-u-lg-4">

                        <label for="goodsType" class="am-form-label am-u-sm-4">商品分类:</label>

                        <div class="am-u-sm-8">

                            <select id="goodsType" name="goodsType">

                                <option value="">-=请选择一项=-</option>

                                <?php foreach($cates as $v):?>

                                <option value="<?php echo $v['catid'];?>"><?php echo $v['catname'];?></option>

                                <?php endforeach;?>

                             

                            </select>

                        </div>

                    </div>

                    <div class="am-form-group am-inline am-u-sm-4 am-u-md-4 am-u-lg-4">

                        <label for="goodsState" class="am-form-label am-u-sm-4">商品状态:</label>

                        <div class="am-u-sm-8">

                        <select id="goodsState" name="goodsState">

                            <option value="">-=请选择一项=-</option>

                            <option value="1">上架</option>

                            <option value="0">下架</option>

                        </select>

                        </div>

                    </div>

                    <div class="am-form-group am-inline am-u-sm-4 am-u-md-4 am-u-lg-4">

                        <label for="source_state" class="am-u-sm-4 am-form-label">关键字搜索:</label>

                        <div class="am-u-sm-8">

                            <input type="text" placeholder="请输入搜素的关键字" id="searchKey" />

                        </div>

                    </div>

                    <div class="am-form-group am-inline am-u-sm-4 am-u-md-4 am-u-lg-4">

                        <label for="goodsPrice" class="am-form-label am-u-sm-4 am-fl">商品单价:</label>

                        <div class="am-u-sm-8 am-u-md-8 am-u-lg-8">

                            <input type="number" class="stable" name="startPrice" id="startPrice" min="1"  />

                            <span class="linkWord">至</span>

                            <input type="number" class="stable" name="endPrice" id="endPrice" min="1"  />

                        </div>

                    </div>

                    <div class="am-form-group am-inline am-u-sm-4 am-u-md-4 am-u-lg-4">

                        <label for="goodsPrice" class="am-form-label am-u-sm-4">库存:</label>

                        <div class="am-u-sm-8">

                            <input type="number" class="stable" id="startRepertory" name="startRepertory" min="1"  />

                            <span class="linkWord">至</span>

                            <input type="number" class="stable" id="endRepertory" name="endRepertory" min="1"  />

                        </div>

                    </div>

                    

                    <div class="am-form-group am-u-sm-12 am-u-md-12 am-u-lg-12 am-text-center">

                        <button type="button" class="am-btn am-btn-secondary searchGoods"><i class="am-icon-search"></i> 查询</button>

                    </div>

                </form>

                <div class="widget-head am-cf" style="clear:both;">

                    <div class="widget-title  am-cf">商品列表</div>

                </div>

                <div class="widget-body  am-fr">

                    <div class="am-u-sm-12 am-u-md-6 am-u-lg-6">

                        <div class="am-form-group">

                            <div class="am-btn-toolbar">

                                <div class="am-btn-group am-btn-group-xs">

                             
                                 <a type="button" class="am-btn am-btn-default am-btn-secondary am-btn-xs" data-am-modal="{target: '#exportFile'}"><span class="am-icon-arrow-up" ></span> 导出</a>  

                                </div>
                               <!--  -->
                                <div class="am-modal am-modal-confirm" tabindex="-1" id="exportFile">
                                    <div class="am-modal-dialog">
                                        <div class="am-modal-hd">导出商品信息</div>
                                        <div class="am-modal-bd">
                                            <form class="am-form tpl-form-line-form" action="<?php echo site_url('/store/Store/Dow_goodsList');?>" method="post">
                                                <div class="am-form-group am-cf" style="min-height: 100px;">
                                                    <label class="am-u-sm-3 am-form-label">商家<span class="red">*</span>：</label>
                                                    <div class="am-u-sm-9 am-u-end">
                                                        <select id="storeid" name="storeid" data-am-selected="{searchBox: 1,maxHeight: 200}">
                                                            <option value="">全部商家</option>
                                                            <?php foreach($store as $v):?>
                                                                <option value="<?php echo $v['store_id'];?>"><?php echo $v['store_name'];?></option>
                                                            <?php endforeach;?>

                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="am-form-group am-cf" style="min-height: 100px;">
                                                    <label class="am-u-sm-3 am-form-label">商品类别<span class="red">*</span>：</label>
                                                    <div class="am-u-sm-9 am-u-end">
                                                        <select id="cate" name="cate">
                                                            <option value="">全部类别</option>
                                                            <?php foreach($cates as $v):?>
                                                                <option value="<?php echo $v['catid'];?>"><?php echo $v['catname'];?></option>
                                                            <?php endforeach;?>

                                                        </select>
                                                    </div>
                                                </div>
                                              
                                                <div class="am-form-group am-cf">
                                                    <button class="am-btn am-btn-default am-btn-xs sureExport" type="button" data-am-modal-cancel>取消</button>
                                                    <button class="am-btn am-btn-xs am-btn-secondary sureExport" type="submit" data-am-modal-confirm>确定</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <div class="goodsSelectDiv">

                                    <select class="goodsSelect" name="goodsSelect">

                                        <option value=""><i class="am-icon-sort"></i>筛选商品</option>

                                        <option value="0">特价商品</option>

                                    </select>

                                </div>
                              

                            </div>

                        </div>

                    </div>

                    <div class="am-u-sm-12">

                        <table width="100%" class="am-table am-table-compact am-text-nowrap tpl-table-black ">

                            <thead>

                                <tr>

                                    <th class="tablecheck"><input type="checkbox" />全选</th>

                                    <th>编号 </th>

                                    <th>商品编号 </th>

                                    <th>一级分类 </th>

                                    <th>图片 </th>

                                    <th width="280">商品名 </th>

                                    <th>所属店铺 </th>   

                                    <th>实时库存<i class="am-icon am-icon-sort" onclick="storeEditGoods(1)"></i> </th>   

                                    <th>商品价格<i class="am-icon am-icon-sort" onclick="storeEditGoods(3)"></i> </th>   

                                    <th>商品状态</th>

                                    <th>首页展示</th>

                                    <th>是否特价</th>

                                    <th>变更时间<i class="am-icon am-icon-sort" onclick="storeEditGoods(5)"></i></th>

                                    <th>操作</th>

                                </tr>

                            </thead>

                            <tbody id="infolistDiv">

                             

                            </tbody>

                        </table>
                        <script type="text/html" id="infolist">
                             <% for(var i=0; i<list.length; i++){ %>

    <tr class="trClass" id="trClass<%= list[i].goods_id%>" data-id="<%= list[i].goods_id%>">

        <td class="am-text-middle" ><input type="checkbox" class="commentBox" data-id="<%= list[i].goods_id%>" name="commentBox"></td>

        <td class="am-text-middle"><%= list[i].goods_id%></td>

        <td class="am-text-middle"><%= list[i].goods_code%></td>

        <td class="am-text-middle"><%= list[i].catname%></td>

        <td class="am-text-middle">

        <%if(list[i].thumb) {%>

            <img src="<%= list[i].thumb%>" class="am-img-responsive" alt=""/>

        <%}else {%>

            暂无图片

        <%}%>

        </td>

        <td class="am-text-middle"><%= list[i].title%></td>

        <td class="am-text-middle"><%= list[i].store_name%></td>

        <td class="am-text-middle"><%= list[i].amount%></td>

        <td class="am-text-middle"><%= list[i].price%></td>

        <!-- <td class="am-text-middle">2016年上半季</td> -->

        <td class="am-text-middle">

        <%if(list[i].goods_state=="1"){%>

            <select class="goodsState" name="goodsState" data-id="<%= list[i].goods_id%>">

                <option value="">-=请选择一项=-</option>

                <option value="1" selected="selected">上架</option>

                <option value="0">下架</option>

            </select>

        <%}else{%>

            <select class="goodsState" name="goodsState" data-id="<%= list[i].goods_id%>">

                <option value="">-=请选择一项=-</option>

                <option value="1">上架</option>

                <option value="0" selected="selected">下架</option>

            </select>

        <%}%>

        </td>

        <td class="am-text-middle">


            <select class="recommend" name="recommentType" data-id="<%= list[i].goods_id%>">

                         <%if(list[i].recommentType == "0"){%>
                            <option value="0" selected="selected">否</option>
                            <option value="1">HI抢购</option>
                            <option value="2">HI货榜</option>
                            <option value="3">HI土货</option>
                            <option value="4">HI洋货</option>
                            <option value="5">HI特色</option>
                            <option value="6">HI推荐</option>
                            <option value="7">HI邀请有礼</option>
                        <%}else{%>
                            <option value="0">否</option>
                            <option value="1" <%if(list[i].recommentType == '1'){%>selected="selected"<%}%>>HI抢购</option>
                            <option value="2" <%if(list[i].recommentType == '2'){%>selected="selected"<%}%>>HI货榜</option>
                            <option value="3" <%if(list[i].recommentType == '3'){%>selected="selected"<%}%>>HI土货</option>
                            <option value="4" <%if(list[i].recommentType == '4'){%>selected="selected"<%}%>>HI洋货</option>
                            <option value="5" <%if(list[i].recommentType == '5'){%>selected="selected"<%}%>>HI特色</option>
                            <option value="6" <%if(list[i].recommentType == '6'){%>selected="selected"<%}%>>HI推荐</option>
                            <option value="7" <%if(list[i].recommentType == '7'){%>selected="selected"<%}%>>HI邀请有礼</option>
                        <%}%>

                    </select>

                </td>

                <td class="am-text-middle">

                <%if(list[i].specials_state =="1"){%>

                    <select class="priceState" name="priceState" data-id="<%= list[i].goods_id%>">

                        <option value="">-=请选择一项=-</option>

                        <option value="1" selected="selected">是</option>

                        <option value="0">否</option>

                    </select>

                <%}else{%>

                    <select class="priceState" name="priceState" data-id="<%= list[i].goods_id%>">

                        <option value="">-=请选择一项=-</option>

                        <option value="1">是</option>

                        <option value="0" selected="selected">否</option>

                    </select>

                <%}%>

                </td>

                <td class="am-text-middle">

                <%if(list[i].update_time) {%>

                    <span><%= list[i].update_time%></span>

                <%}else {%>

                    <span><%= list[i].create_time%></span>

                <%}%>

                </td>

                <!--<td><%= list[i].sort %></td>-->

                <td class="am-text-middle">

                    <div class="tpl-table-black-operation">
                        <a data-id="<%= list[i].goods_id%>" class="" data-storeId="<%= list[i].storeid%>" data-am-modal="{target: '#look<%=goods_id%>'}">
                                    
                            <i class="am-icon-search"></i> 查看二维码

                        </a>

                        <a data-id="<%= list[i].goods_id%>" class="editGoods">

                            <i class="am-icon-pencil"></i> 编辑

                        </a>

                        <a data-id="<%= list[i].goods_id%>" class="tpl-table-black-operation-del tpl-del">

                            <i class="am-icon-trash"></i> 删除

                        </a>

                    </div>

                </td>   

            </tr>

            <!-- 查看二维码弹框 -->
            <div class="am-modal am-modal-alert" tabindex="-1" id='look<%=goods_id%>'>
                <div class="am-modal-dialog">
                    <div class="am-modal-hd">查看商品二维码</div>
                    <div class="am-modal-bd">
                        <!-- <input type="hidden" id="codename" value="<%= list[i].goodsid%><%= list[i].title%>"> -->
                       <%if(list[i].QrCodeSync){%>
                        <div class="nowcode code" style="display:block"></div>
                       <button style="margin-bottom:50px" style="display:none;" data-id="<%= list[i].goods_id%><%= list[i].title%>" type="button" class="am-btn am-btn-primary dow_Qcode">下载</button> 
                       
                        <%}else{%>
                        <div style="padding:10px;text-align:center;margin:50px" class="code">还未生成二维码</div>
                        <button style="margin-bottom:50px" data-id="<%= list[i].goods_id%>" data-storeId="<%= list[i].storeid%>" type="button" class="am-btn am-btn-primary btn-loading-example">生成二维码</button> 
                        <button style="margin-bottom:50px;display:none;margin:auto;text-algin:center" data-id="<%= list[i].goods_id%><%= list[i].title%>" type="button" class="am-btn am-btn-primary dow_Qcode" >下载</button> 
                        <%}%>
                    </div>
                    <div class="am-modal-footer">
                    <span class="am-modal-btn">确定</span>
                    </div>
                </div>
            </div>
            <!-- 删除弹框 -->
            <div class="am-modal am-modal-confirm" tabindex="-1" id="<%= list[i].goods_id%>">

                <div class="am-modal-dialog">

                    <div class="am-modal-hd">删除提示</div>

                    <div class="am-modal-bd">

                        <p class="black">你，确定要删除这条记录吗？</p>

                    </div>

                    <div class="am-modal-footer">

                        <span class="am-modal-btn" data-am-modal-cancel>取消</span>

                        <span class="am-modal-btn sureDelete" data-id="<%= list[i].goods_id%>" data-am-modal-confirm>确定</span>

                    </div>

                </div>

            </div>
            <%}%>
        </script>

                    </div>

                    <div value="1 0"></div>
                    <div id="page" class="page_div"></div>

                </div>

            </div>

        </div>

    </div>

</div>

</div>

<div class="goTop"><a href="javascript:scroll(0,0)" type="button"><img src="assets/img/top.png" alt="点我回到顶部"></a></div>



<!--加入展销-->



<script src="assets/js/artTemplate-native.js"></script>

<script type="text/javascript">


    //删除图片

    $(".deleteImg").click(function(){      

        $(this).prevUntil('.preview').find('img').attr('src','assets/img/nullImg.jpg');

        $(this).prevUntil('.preview').find('input').val("");

        $(this).prevUntil('.preview').find('input').files="";

    }); 

  

    //

    //异步刷新的ajax请求   

  $(document).ready(function(){


    $('#add_sales').click(function(){

        var array=[];

        for(var i=0;i<$('tr.trClass td input:checkbox[name=commentBox]:checked').length;i++){

            

            array[i]=$('tr.trClass td input:checkbox[name=commentBox]:checked').eq(i).attr("data-id");

        }

        // console.log(array);

        if(array == ''){

            alert('你还没有选择商品！');

            return false;

        }else{

            goodsid=JSON.stringify(array);

               $.ajax({

                type:'post',

                url:'<?php echo site_url('/store/Store/add_sales_goods');?>',

                data: 'goodsid='+goodsid+'&id='+'<?php echo $saleid;?>',

                success: function(data){

                    if(data==1){

                        alert('加入成功');

                       window.location.href='<?php echo site_url("/store/Specialty/hot_goods_list");?>';

                    }else{

                        alert("操作失败！");

                    }

                },

                error:function(xhr,type,errorThrown){

                    alert("操作失败，请检查网络设置！");

                }

            });

           // $("#goodsid").val(goodsid);



        }

    });

    if($('.goodsSelect').val()=="0"){

        $('.goodsSelect').css({'background':'#e0690c','border':'1px solid #e0690c'});

    }



    function otherFunction() {

        $('.editGoods').click(function(){//编辑商品信息

            var dataId=$(this).attr('data-id');

            $(this).attr("href","<?php echo site_url('store/Store/storeEditGoods/" + dataId + "');?>");

        });

        // //商品上下架

        for(var i=0; i<$('.tpl-del').length; i++) {

            var dataId = $('.tpl-del').eq(i).attr('data-id');

            $('.tpl-del').eq(i).attr("data-am-modal","{target: '#"+ dataId +"'}");

            if($('.goodsState').eq(i).val()=="0"){

                $('.goodsState').eq(i).css({'background':'#e0690c','border-radius':'5px','border':'1px solid #e0690c','padding':'5px 5px','color': '#fff'});

            } 

            if($('.recommend').eq(i).val()=="0"){

                $('.recommend').eq(i).css({'background':'#e0690c','border-radius':'5px','border':'1px solid #e0690c','padding':'5px 5px','color': '#fff'});

            }     

            if($('.priceState').eq(i).val()=="0"){

                $('.priceState').eq(i).css({'background':'#e0690c','border-radius':'5px','border':'1px solid #e0690c','padding':'5px 5px','color': '#fff'});

            }

            

             if($('.goodsState').eq(i).val()=="1"){

                $('.goodsState').eq(i).css({'background':'#15b5ac','border-radius':'5px','border':'1px solid #15b5ac','padding':'5px 5px','color': '#fff'});

            } 

            if($('.recommend').eq(i).val()=="1"){

                $('.recommend').eq(i).css({'background':'#15b5ac','border-radius':'5px','border':'1px solid #15b5ac','padding':'5px 5px','color': '#fff'});

            }     

            if($('.priceState').eq(i).val()=="1"){

                $('.priceState').eq(i).css({'background':'#15b5ac','border-radius':'5px','border':'1px solid #15b5ac','padding':'5px 5px','color': '#fff'});

            }

                                

        }

        //点击选中所有

       

        //更改商品的状态

        $('.goodsState').change(function(){

            var dataId=$(this).attr('data-id'), goodState = 0;

            if($(this).find('option:selected').val()=="1"){

                goodState = 1;

                $(this).css({'background':' #15b5ac','border-radius':'5px','border':'1px solid #15b5ac','padding':'5px 5px','color': '#fff'}); 

            }else{

                goodState = 0;

                $(this).css({'background':' #e0690c','border-radius':'5px','border':'1px solid #e0690c','padding':'5px 5px','color': '#fff'}); 

            }
            console.log(goodState);

            $.ajax({

                type:'post',

                url:'<?php echo site_url('/shop/SingleShop/edit_goods_state');?>',

                data: 'goodsid='+ dataId+'&state='+ goodState,

                success: function(data){

                    if(data==1){



                    }else{

                        alert("操作失败！");

                    }

                    

                },

                error:function(xhr,type,errorThrown){

                    alert("操作失败，请检查网络设置！");

                }

            });

            

        });

        //推荐商品

        $('.recommend').change(function(){

            var dataId=$(this).attr('data-id');
            var state = $(this).val();
            console.log(dataId,state);

            if($(this).find('option:selected').val() !="0"){


                $(this).css({'background':' #15b5ac','border-radius':'5px','border':'1px solid #15b5ac','padding':'5px 5px','color': '#fff'}); 

            }else{


                $(this).css({'background':' #e0690c','border-radius':'5px','border':'1px solid #e0690c','padding':'5px 5px','color': '#fff'}); 

            }

            $.ajax({

                type:'post',

                url:'<?php echo site_url('/store/Store/edit_recommend');?>',

                data: 'goodsid='+ dataId+'&state='+ state,

                success: function(data){

                    if(data==1){
                        alert('操作成功！');
                    }else{

                        alert("操作失败！");

                    }

                    

                },

                error:function(xhr,type,errorThrown){

                    alert("操作失败，请检查网络设置！");

                }

            });

            

        });

        //商品特价

        $('.priceState').change(function(){

            var dataId=$(this).attr('data-id'), state = 0;

            if($(this).find('option:selected').val()=="1"){

                state = 1;

                $(this).css({'background':'#15b5ac','border-radius':'5px','border':'1px solid #15b5ac','padding':'5px 5px','color': '#fff'}); 

            }else{

                state = 0;

                $(this).css({'background':' #e0690c','border-radius':'5px','border':'1px solid #e0690c','padding':'5px 5px','color': '#fff'}); 

            }

            $.ajax({

                type:'post',

                url:'<?php echo site_url('/shop/SingleShop/specials_goods');?>',

                data: 'goodsid='+ dataId+'&specials_state='+ state,

                success: function(data){

                    console.log(data);

                    if(data==1){

                        alert('操作成功');

                    }else{

                        alert("操作失败！");

                    }

                    

                },

                error:function(xhr,type,errorThrown){

                    alert("操作失败，请检查网络设置！");

                }

            });

        });

        //删除商品的AJAX请求

        $('.sureDelete').click(function(){

            var dataId=$(this).attr('data-id');

            $.ajax({

                type:'post',

                url:'<?php echo site_url('/shop/SingleShop/del_goods/');?>',

                data: 'goodsid='+dataId,

                success: function(data){

                    if(data==1){  

                      alert("操作成功！");                                         

                      getList('<?php echo site_url('store/store/storeGoods_page');?>', 'default=1');

                    }else{

                        alert("操作失败！");

                    }

                    

                },

                error:function(xhr,type,errorThrown){

                    alert("操作失败，请检查网络设置！");

                }

            });
        });

        //下载二维码
        $('.dow_Qcode').click(function(){ 
            var svgXml = $(this).parent().find('.code').html();
            var codename=$(this).attr('data-id');
           // alert(dataId);
            var image = new Image();
            image.src = 'data:image/svg+xml;base64,' + window.btoa(unescape(encodeURIComponent(svgXml))); //给图片对象写入base64编码的svg流

            var canvas = document.createElement('canvas');  //准备空画布
            canvas.width =$(this).parent().find('.code svg').width();
            canvas.height =$(this).parent().find('.code svg').height();

            var context = canvas.getContext('2d');  //取得画布的2d绘图上下文
            context.drawImage(image, 0, 0);

            var a = document.createElement('a');
            a.href = canvas.toDataURL('image/jpg');  //将画布内的信息导出为png图片数据
            a.download = codename;  //设定下载名称
            a.click(); //点击触发下载

        });

        

        

    }


    // 初始化节点，无数据关联
    $("#page").paging({
        pageNo: 1,
        totalPage: 10,
        totalSize: 100,
        callback: function(num) {
            getListinfo(num,'','','','','','','','',"<?php echo site_url('store/Store/goods_search');?>");
        }
    })
    
    // 初始化,加载第一页
    var page = "<?php if(!isset($_SESSION['goodNum'])){echo '0';}else{echo $_SESSION['goodNum'];}?>"/10 +1;


    getListinfo(page,'','','','','','','','',"<?php echo site_url('store/Store/goods_search');?>");
    
    // 新分页方法
    function getListinfo(num,cateid,state,sear,startPrice,endPrice,startRepertory,endRepertory,diff,url) {

        var pagenum10 = (num-1) *10;
       
        $.ajax({
            url: url,
            type: "post",
            data: {
                'start':pagenum10,
                'count':10,
                'cateid':cateid,
                'state':state,
                'sear':sear,
                'startPrice':startPrice,
                'endPrice':endPrice,
                'startRepertory':startRepertory,
                'endRepertory':endRepertory,
                'diff':'4',
            },
            // dataType: "json",
            success: function(data) {
                // console.log(data);
                if(data != 2){
                    var res = JSON.parse(data);
                    var allpage = Math.ceil(res.total/10);  
                    // console.log(allpage);
                    //分页
                    $("#page").paging({
                        pageNo: num,
                        totalPage: allpage,
                        totalSize: res.total,
                        callback: function(num) { //点击页码的 回调 方法
                            // console.log(num);
                            getListinfo(num,cateid,state,sear,startPrice,endPrice,startRepertory,endRepertory,diff,"<?php echo site_url('store/Store/goods_search');?>");
                        }
                    })
                    // 铺数据
                    var dataobj = {};
                    var lists = res.subjects;
                  
                    dataobj.list = lists;
                    var html=template("infolist",dataobj);
                    document.getElementById("infolistDiv").innerHTML = html;
                }
                otherFunction();

                       //生成二维码
                        $('.btn-loading-example').click(function () { 
                            var $btn = $(this); 
                            var storeId =$btn.attr("data-storeId");
                            var goods_id =$btn.attr("data-id"); 
                            
                            $btn.button('loading'); 
                            setTimeout(function(){
                                $btn.button('reset');
                            }, 10000);
                            $.ajax({

                                type:'post',
                                
                                url:'http://abcd.zlzmm.com:6789/index.php/Api_goods/ret_Qrcode',
                                // headers:{'token':"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mbyI6e30sImlhdCI6MTUxMzMxMDMxNywiZXhwIjoxNTEzMzE3NTE3fQ.cpcOuad_Xtk1VvrWq_aiFWkJbUl3257Lmu3S9SHlz8s"},
                                data: {goods_id:goods_id,storeid:storeId},

                                success: function(data){     
                        
                              //  console.log('ewm',data)
                                if(data == 1 ){
                                    alert('生成失败！');
                                }else{
                                    $btn.prev().html(data);
                                    $btn.button('reset'); 
                                    $btn.css('display','none');
                                    $btn.next().css('display','block');
                                }

                                },

                                error:function(xhr,type,errorThrown){
                                console.log('erro',xhr)
                                    
                                    $btn.button('reset');
                                    alert("网络状况不佳，请稍后重试！");

                                }

                            });
                        
                        });


            },
            error:function(data){
                console.log(data);
            }
        })


     
    }
    

    //点击搜索

    $('.searchGoods').click(function(){

        var goodsType=$('#goodsType option:selected').val(),goodsState=$('#goodsState option:selected').val(),keywords=$('#searchKey').val();

        var startPrice=$('#startPrice').val(),endPrice=$('#endPrice').val(),startRepertory=$('#startRepertory').val(),endRepertory=$('#endRepertory').val();

        if((startPrice=="" && endPrice!="") || (startPrice!="" && endPrice=="")){

            alert("交易总额必须是一个范围！");

            return false;

        }else if((startRepertory=="" && endRepertory!="") || (startRepertory!="" && endRepertory=="")){

            alert("库存必须是一个范围！");

            return false;

        }else{

            // console.log('cateid='+ goodsType +'&startPrice='+ startPrice +'&endPrice='+ endPrice +'&startRepertory='+ startRepertory +'&endRepertory='+ endRepertory +'&state='+ goodsState +'&sear='+keywords);

             // getList('<?php echo site_url('store/store/goods_search');?>','diff=4'+'&cateid='+ goodsType +'&startPrice='+ startPrice +'&endPrice='+ endPrice +'&startRepertory='+ startRepertory +'&endRepertory='+ endRepertory +'&state='+ goodsState +'&sear='+keywords);
             getListinfo(1,goodsType,goodsState,keywords,startPrice,endPrice,startRepertory,endRepertory,'4',"<?php echo site_url('store/Store/goods_search');?>");
        }


        

    });



})








</script>



<script>
 
</script>