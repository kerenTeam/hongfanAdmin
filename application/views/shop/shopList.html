 

<style type="text/css" media="screen">

.am-selected {

    width: 100%!important;

}

.table-check {

    width: 30px;

}

.hf-dropdown {

    font-size: 12px!important;

    padding: 5px 6px!important;

} 

.shopState {

    width: 80px;

    background: #15b5ac;

    border-radius: 5px;

    border: 1px solid #15b5ac;

    padding:5px 5px;

    color: #fff;

    text-align: center;

} 

  

.shopState option {

    background: #fff;

    border-radius: 5px;

    border: 1px solid #aaa;

    padding:2px 5px;

    color: #000;

    text-align: center;

}

.shopState option[selected="selected"] {

    background: #15b5ac;



}

.editShop {

    border:1px solid #e0690c !important;

    padding:5px 6px !important;

    color: #e0690c !important;

}

.editShop:hover {

    background: #e0690c !important;

    color: #fff !important;

}

#preview {

    height:150px !important;

}

#preview #imghead,#preview img {

    height:140px !important;

}

.isRecommand {

    border: 1px solid #5eb95e !important;

    color: #5eb95e !important;

}

.gray {

    border: 1px solid #282d2f !important;

    color: #282d2f !important;

}

.isRecommand:hover {

    cursor: pointer;

}

</style>



<!-- 内容区域 -->

<div class="tpl-content-wrapper">

<div class="container-fluid am-cf">

    <div class="row">

        <div class="am-u-sm-12 am-u-md-12 am-u-lg-9">

            <div class="page-header-heading"><span class="am-icon-home page-header-heading-icon"></span> 商铺管理

            <a href="<?php echo site_url().'/shop/shop/index';?>" style="font-size:16px;">商家列表</a><small></small></div>

        </div>

    </div>

</div>

<div class="row-content am-cf">

    <div class="row">

        <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">

            <div class="widget am-cf">

                <div class="widget-head am-cf">

                    <div class="widget-title  am-cf">商家查询</div>

                </div>

                <form class="am-form am-form-horizontal am-padding-sm am-text-sm">

                    <div class="am-form-group am-u-sm-4 am-u-md-4 am-u-lg-4">

                        <label for="yetai" class="am-u-sm-3 am-form-label">分类业态</label>

                        <div class="am-u-sm-9">

                            <select id="yetaiSort">

                                <option value="">-=请选择一项=-</option>

                                <?php foreach($yetai as $val):?>

                                    <option value="<?php echo $val['id']?>"><?php echo $val['type_name']?></option>

                                <?php endforeach;?>

                            </select>

                        </div>

                    </div>

                    <div class="am-form-group am-u-sm-4 am-u-md-4 am-u-lg-4">

                        <label for="shop_state" class="am-u-sm-3 am-form-label">状态</label>

                        <div class="am-u-sm-9">

                            <select id="shopstate">

                                <option value="">-=请选择=-</option>

                                <option value="1">正常</option>

                                <option value="0">冻结</option>

                            </select>

                        </div>

                    </div>

              

                   <!--  <div class="am-form-group am-u-sm-4 am-u-md-4 am-u-lg-4">

                        <label for="source_state" class="am-u-sm-3 am-form-label">铺号</label>

                        <div class="am-u-sm-9">

                            <input type="text" placeholder="" id="berth">

                        </div>

                    </div> -->

                     <div class="am-form-group am-u-sm-4 am-u-md-4 am-u-lg-4">

                        <label for="source_state" class="am-u-sm-3 am-form-label">关键字查询</label>

                        <div class="am-u-sm-9">

                            <input type="text" placeholder="" id="keywords">

                        </div>

                    </div>

                    <div class="am-form-group am-u-sm-12 am-u-md-12 am-u-lg-12 am-text-center">

                        <button type="button" class="am-btn am-btn-secondary searchShop"><i class="am-icon-search"></i> 查询</button>

                    </div>

                </form>

                <div class="widget-head am-cf">

                    <div class="widget-title  am-cf" style="clear: both;">商家列表</div>

                </div>

                <div class="widget-body  am-fr">

                    <div class="am-u-sm-12 am-u-md-6 am-u-lg-6">

                        <div class="am-form-group">

                            <div class="am-btn-toolbar">

                                <div class="am-btn-group am-btn-group-xs">

                                    <button type="button" class="am-btn am-btn-default am-btn-success"><a href="<?php echo site_url().'/shop/shop/addShop/2';?>"><span class="am-icon-plus"></span> 新增</a></button>

                                    <!--<div class="wx_type_img am-inline">

                                         <input type="file" id="imgUpload" name="xml" onchange="uploadFiles()" class="upload-add fileUpLoad" >

                                          <!-- 图片实时预览 -->

                                          <!--<button class="am-btn am-btn-secondary am-btn-xs"><span class="am-icon-arrow-down"></span> 导入</button>

                                    </div>-->

                                    <!--<a href="<?php echo site_url('/shop/shop/dowload_store/2');?>" class="am-btn am-btn-default am-btn-danger"><span class="am-icon-arrow-up"></span> 导出</a> -->

                                    <!--<a href="Upload/xls/impolt_store.xlsx" class="am-btn am-btn-default am-btn-primary"><span class="am-icon-arrow-up"></span> 下载导入模板</a>-->



                                </div>

                            </div>

                        </div>

                    </div>

                    <div class="am-u-sm-12">

                        <table width="100%" class="am-table am-table-compact am-text-nowrap tpl-table-black ">

                            <thead>

                                <tr>

                                    <th class="tablecheck"><input type="checkbox" /></th>

                                    <!--<th>商场名称 </th>-->

                                    <th>商铺编号 </th>

                                    <th>商铺名称 </th>

                                    <!-- <th>商铺类型 </th> -->

                                    <th>品牌 </th>

                                    <th>创建时间</th>

                                    <th>状态</th>

                                    <th>操作</th>

                                </tr>

                            </thead>

                            <tbody id="dataList">

                                <tr class="trClass"><td colspan="12" class="am-text-center"><img class="imgBox" src="assets/img/huanchong.gif"></td><td></td></tr>

                                <!-- more data -->

                            </tbody>

                        </table>

                    </div>

                    <div class="am-u-lg-12 am-cf am-text-center pagebox">

                        <div id="Pagination">

                            <div class="pagination">

                                <a class="prev"><i></i>上一页</a>

                                <a class="current">1</a>

                                <a >2</a>

                                <a>3</a>

                                <a>4</a>

                                <span class="pagination-break">...</span>

                                <a class="ep">15</a>

                                <a class="next">下一页 <i></i></a>

                            </div> 

                        </div>

                        <div class="searchPage">

                          <span class="page-sum">共<strong class="allPage">15</strong>页</span>

                          <span class="page-go">跳转<input type="text">页</span>

                          <a href="javascript:;" class="page-btn">确定</a>

                        </div>

                        <div claa="am-text-middle">

                           <span>共<span class="allData">15</span>条数据</span> 

                        </div>

                    </div>

                </div>

            </div>

        </div>

    </div>

</div>

</div>

<!--加入达人推荐的弹窗开始-->



<!--加入达人推荐的弹窗结束-->

<div class="goTop"><a href="javascript:scroll(0,0)" type="button"><img src="assets/img/top.png" alt="点我回到顶部"></a></div>

<script type="text/javascript">

    var total_page=0,pageflag = 1, $shopList = parseInt(sessionStorage.getItem('shopList')) || 0, $isShopList = parseInt(sessionStorage.getItem('isShopList')) || 0;

    function otherFunction() {

        $('.editShop').click(function(){//编辑商家信息

            var dataId=$(this).attr('data-id');

            $(this).attr("href","<?php echo site_url('/shop/shop/editShop/" + dataId + "');?>");

        });

        $('.manageShop').click(function(){//管理商家信息

            var dataId=$(this).attr('data-id');

            $(this).attr("href","<?php echo site_url('/shop/singleShop/shopAdmin/" + dataId + "');?>");

        });

        for(var i=0;i<$('.tpl-del').length;i++){

            var dataId=$('.tpl-del').eq(i).attr('data-id'), recommandId =  $('.isRecommand').eq(i).attr('data-id');

            $('.tpl-del').eq(i).attr("data-am-modal","{target: '#"+ dataId +"'}");

            $('.isRecommand').eq(i).attr("data-am-modal","{target: '#re"+ recommandId +"'}");

            if($('.shopState option:selected').eq(i).val()=="0"){

                $('.shopState').eq(i).css({'background':' #e0690c','border-radius':'5px','border':'1px solid #e0690c','padding':'5px 5px','color': '#fff'});

            }                          

        }

        //点击选中所有

        $('.tablecheck').click(function() {

            var start_page=parseInt(15)*parseInt($shopList);

            var end_page=parseInt(15)*parseInt($shopList+1);

            if(flag==0){

              for(var i = start_page; i < end_page; i++) {

                if(document.getElementsByClassName('commentBox')[i]){

                    document.getElementsByClassName('commentBox')[i].checked=true;

                }        

              }  

              flag=1;

            }else{

               for(var i = start_page; i < end_page; i++) {

                if(document.getElementsByClassName('commentBox')[i]){

                    document.getElementsByClassName('commentBox')[i].checked=false;

                }  

               }

               flag=0;

            }

        });

        //更改商家的状态

        $('.shopState').change(function(){

            var dataId=$(this).attr('data-id');

            if($(this).find('option:selected').val()=="1"){

                $.ajax({

                    type:'post',

                    url:'<?php echo site_url('/shop/Shop/edit_shop_state');?>',

                    data: 'id='+ dataId+'&state=1',

                    success: function(data){
                      //  console.log(data);
                        if(data==1){

                            

                        }else{

                            alert("操作失败！");

                        }

                    },

                    error:function(xhr,type,errorThrown){

                        alert("操作失败，请检查网络设置！");

                    } 

                });

                $(this).css({'background':'#15b5ac','border':'1px solid #15b5ac'});

            }else{

                $.ajax({

                    type:'post',

                    url:'<?php echo site_url('/shop/shop/edit_shop_state');?>',

                    data: 'id='+ dataId+'&state=2',

                    success: function(data){

                        if(data==1){



                        }else{

                            alert("操作失败！");

                        }

                    },

                    error:function(xhr,type,errorThrown){

                        alert("操作失败，请检查网络设置！");

                    }

                });

                $(this).css({'background':'#e0690c','border':'1px solid #e0690c'}); 

            }

            

            

        });







        //删除商家的AJAX请求

        $('.sureDelete').click(function(){

            var dataId=$(this).attr('data-id');

            $.ajax({

                type:'post',

                url:'<?php echo site_url('/shop/Shop/del_shop_store');?>',

                data: 'id='+dataId,

                success: function(data){

                    if(data==1){

                        $('#trClass'+dataId).remove();

                    }else{

                        alert("操作失败！");

                    }

                    

                },

                error:function(xhr,type,errorThrown){

                    alert("操作失败，请检查网络设置！");

                }

            });

            

        });

        //推荐到HOT

        $('.sureRecommand').click(function(){

            var dataId=$(this).attr('data-id'), banner = $(this).attr('dataId');

            if(banner == "0") {

                banner_state = 1;

            } else {

                banner_state = 0;

            }

            console.log('q_id='+ dataId + '&banner_state='+ banner_state);

            $.ajax({ 

                type:'post',

                url: "<?php echo site_url('/find/Find/findSpecial_recommend');?>",

                data: 'q_id='+ dataId + '&banner_state='+ banner_state,

                success: function(result){    

                    // console.log(result);     

                    var res = eval(result);

                    if(res == 1){

                        alert("保存成功！");

                        $('#de'+dataId).fadeOut();

                        $('.am-dimmer').removeClass('am-active');

                        getList('<?php echo site_url('/find/Find/ret_findSpecial_list');?>','type='+index);

                    }else{

                       alert("网络状况不佳，请稍后重试！");

                    }

                    

                },

                error:function(xhr,type,errorThrown){

                    alert("网络状况不佳，请稍后重试！");

                }

            });

        });

        //删除图片

        $(".deleteImg").click(function(){      

            $(this).prevUntil('.preview').find('img').attr('src','assets/img/nullImg.jpg');

            $(this).prevUntil('.preview').find('input').val("");

        });

    }

    //点击前往某一页的函数

    function go_to_page(page_num){

        $('.page_link').removeClass('active_page');

        $('.page_link').eq(page_num).addClass('active_page');

        $("#dataList").children('tr').css("display","none");

        var start_page=parseInt(15)*parseInt(page_num);

        var end_page=parseInt(15)*parseInt(page_num+1);

        $('#dataList').children('tr').slice(start_page,end_page).css('display','');

        current_page=page_num;

        sessionStorage.setItem('shopList', current_page);

        $goodsList = parseInt(sessionStorage.getItem('shopList'));     

    }



    //点击上一页的函数

    function previous(){

        if($('.current').length>1) {

            new_page = parseInt($('.current').eq(0).html()) - 2;

        }else {

            new_page = parseInt($('.current').html()) - 2;

        }

        if(new_page >= 0) {

            go_to_page(new_page);

        }

    }



    //点击下一页的函数

    function next(argu){

        if($('.current').length>1) {

            new_page = parseInt($('.current').eq(1).html());

        }else {

            new_page = parseInt($('.current').html());

        }     

        if(new_page < argu){   

            console.log(new_page + ' ' + argu);

            go_to_page(new_page);

        }

    }

    //导入数据

    function uploadFiles(){

        var fileObj=document.getElementsByClassName('fileUpLoad')[0].files[0];//获取文件对象

       // console.log(fileObj.name.split('.')[1]);

        var FileController="<?php echo site_url('/shop/Shop/impolt_store');?>";//上传文件的后台地址

        if(fileObj.name.split('.')[1]=='xml' || fileObj.name.split('.')[1]=='xlsx'){

           var form=new FormData();

            form.append('file',fileObj); //文件对象

            form.append('typeid','2'); //文件对象

            //实例化XMLHttpRequest对象

            var xhr=new XMLHttpRequest();

            xhr.open('post',FileController,true);

            xhr.onload=function(){

                alert("导入成功！");

                location.reload();

            

            };

            xhr.send(form); 

            return true;

        }else{

            alert("上传文件的格式错误！");

            return false;

        }

        

    }



    //实例化编辑器

    var flag=0;

    

    //异步刷新的ajax请求   

    function getList(dataurl,data){

        $.ajax({

        type:'post',

        url:dataurl,

        data: data,

        success: function(result){  

            var res = eval(result);

            // console.log(res);

            if(res != 2 && res != 3){

                var listData = ''; //每页出现的数量

                total_page = Math.ceil(res.length/15); //得到总页数

                for(var i = 0; i < res.length; i++){

                    listData+= template('dataModal',res[i]);

                 }

                document.getElementById('dataList').innerHTML = listData;

                $('.allData').html(res.length);

                $('.pagebox').css('display', 'block');

                if(total_page <= 1) {

                    $('#Pagination').css('display', 'none');

                    $('.searchPage').css('display', 'none');

                } else {

                    if(pageflag) {

                        var opts={};opts.current_page = $shopList;

                        $("#Pagination").pagination(total_page, opts); 

                        go_to_page($shopList);

                        pageflag = 0;

                    } else {

                        $("#Pagination").pagination(total_page);

                        go_to_page(0);

                        

                    }

                    if(total_page < 5) {

                        $('.searchPage').css('display', 'none');

                    }

                }

                

                otherFunction();

            }else{

                $('#dataList').find('tr').remove();

                $('<tr class="trClass"><td colspan="12" class="am-text-center"><p id="nullMessage">暂无商家信息！</p></td></tr>').appendTo('#dataList');

                $('.pagebox').css('display', 'none');

            }



            

        },

        error:function(xhr,type,errorThrown){

            alert("网络状况不佳，请稍后重试！");

            $('#dataList').find('tr').remove();

            $('<tr class="trClass"><td colspan="12" class="am-text-center"><p id="nullMessage">暂无商家信息！</p></td></tr>').appendTo('#dataList');

            $('.pagebox').css('display', 'none');

        }

    });

}

$(document).ready(function(){

    //加载列表数数据


        getList('<?php echo site_url('/shop/shop/return_shop_page');?>','typeid=2');

    

    

    //点击搜索

    $('.searchShop').click(function(){

        var yetaiSort=$('#yetaiSort option:selected').val(),shopstate=$('#shopstate option:selected').val(),keywords=$('#keywords').val();

        // console.log('yetai='+ yetaiSort +'&state='+ shopstate +'&floor='+ floorNumber +'&berth='+ berth +'&sear='+keywords);

       getList('<?php echo site_url('/shop/Shop/search_store');?>','yetai='+ yetaiSort +'&state='+ shopstate  +'&sear='+keywords);

       sessionStorage.setItem('isShopList', 1);

    });

})

</script>

<script type="text/html" id="dataModal">

    <tr class="trClass" data-id="<%= store_id%>" id="trClass<%= store_id%>">

        <td class="am-text-middle" ><input type="checkbox" data-id="<%= store_id%>" class="commentBox" name="commentBox"></td>

        <!--<td>宏帆广场</td>-->

        <td class="am-text-middle"><%= store_id%></td>

        <td class="am-text-middle"><%= store_name%></td>

        <td class="am-text-middle"><%= barnd_name%></td>

        <td class="am-text-middle"><%= create_time%></td>

        <td class="am-text-middle">

            <%if(state=="1"){%>

            <select id="" class="shopState" name="shopState" data-id="<%= store_id%>">

                <option value="">-=请选择=-</option>

                <option value="1" selected="selected">正常</option>

                <option value="0">冻结</option>

            </select>

            <%}else{%>

            <select id="" class="shopState" name="shopState" data-id="<%= store_id%>">

                <option value="">-=请选择=-</option>

                <option value="1">正常</option>

                <option value="0" selected="selected">冻结</option>

            </select>

            <%}%>

        </td>

        <td class="am-text-middle">

            <div class="tpl-table-black-operation">

                <a data-id="<%= store_id%>" class="manageShop">

                    <i class="am-icon-gear" ></i> 管理

                </a>

             

                <a data-id="<%= store_id %>" class="editShop">

                    <i class="am-icon-pencil"></i> 编辑

                </a>

                <a data-id="<%= store_id %>" class="tpl-table-black-operation-del tpl-del">

                    <i class="am-icon-trash"></i> 删除

                </a>

            </div>

        </td>

    </tr>

    <div class="am-modal am-modal-confirm" tabindex="-1" id="re<%= store_id %>">

        <div class="am-modal-dialog">

            <div class="am-modal-hd">推荐</div>

            <div class="am-modal-bd">

                <form class="am-form tpl-form-line-form"  data-am-validator method="post" enctype='multipart/form-data'>

                    <div class="am-form-group am-cf">

                        <label class="am-u-sm-3 am-text-right">推荐图<span class="red">*</span>：</label>

                        <div class="am-u-sm-8 am-u-end">

                            <div class="wx_type_img">

                                <input type="file" id="imgUpload" name="img" onchange="previewImage(this)" class="upload-add am-form-field"  required>

                                <div id="preview"> <img style="border-radius: 3px;" src="<%=  %>" class="am-img-responsive cardView" id="banner_pic<%= store_id %>"> </div>

                             </div>

                            <span class="deleteImg"><i class="am-icon-trash"></i> 删除</span> 

                            <small class="red">提示：图片格式支持：PNG、JPG、JPEG，最大支持2M；</small> 

                        </div>

                    </div>

                    <div class="am-form-group am-cf am-btn-group-xs">

                        <button type="button" class="am-btn am-btn-default" data-am-modal-close>取消</button>

                        <button type="submit" class="am-btn am-btn-secondary sureRecommand" data-id="<%= store_id %>">保存</button>

                    </div>

                </form>      

            </div>

            

        </div>

    </div>

    <div class="am-modal am-modal-confirm" tabindex="-1" id="<%= store_id%>">

        <div class="am-modal-dialog">

            <div class="am-modal-hd">删除提示</div>

            <div class="am-modal-bd">

                <p class="black">你，确定要删除这条记录吗？</p>

            </div>

            <div class="am-modal-footer">

                <span class="am-modal-btn" data-am-modal-cancel>取消</span>

                <span class="am-modal-btn sureDelete" data-id="<%= store_id%>" data-am-modal-confirm>确定</span>

            </div>

        </div>

    </div>

</script>



