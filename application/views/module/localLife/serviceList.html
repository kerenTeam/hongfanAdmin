<style type="text/css" media="screen">

.am-selected {

    width: 100%!important;

}

.table-check {

    width: 30px;

}

.hf-dropdown {

    font-size: 12px!important;

    padding: 5px 6px!important;

}

.am-imgContainer {

    width:50%;

}

.deleteImg {

    display:inline-block;

    width:60px;

    height:25px;

    line-height: 25px;

    text-align: center;

    color: #666;

    font-size: 1.2rem;

    border:  1px solid #ddd;

}

.clickUp {

    display: inline-block;

    float: left;

    margin-left: 100px;

}



.preview {

    height:170px !important;

}

.preview #imghead,#preview img {

    height:160px;

}

.am-modal-bd input[type='radio'] {

    width: 50%;

    border: none;

}

.isRecommand, .isRecommand1, .isRecommand2{

    border: 1px solid #5eb95e !important;

    color: #5eb95e !important;

}



.gray {

    border: 1px solid #282d2f !important;

    color: #282d2f !important;

}

.isRecommand:hover, .isRecommand1:hover, .isRecommand2:hover{

    cursor: pointer;

}

 

 

</style>



<!-- 内容区域 -->

<div class="tpl-content-wrapper">

<div class="container-fluid am-cf">

    <div class="row">

        <div class="am-u-sm-12 am-u-md-12 am-u-lg-9">

            <div class="page-header-heading"><span class="am-icon-home page-header-heading-icon"></span> <a href="<?php echo site_url('/module/LocalLife/localLifeList');?>">本地生活</a> 

            <small>><?php if(isset($catename)):?><a href="<?php echo site_url('/module/LocalLife/serviceList/').$id;?>"><?php echo $catename;?></a>><?php endif;?> <?php echo $name;?></small></div>

        </div>

    </div>

</div>

<div class="row-content am-cf">

    <!-- 以下列表 根据传过来的类别进行判断 控制显示和隐藏 -->

    <?php if($typeid == 1){?>

    <!-- 服务类 -->

    <div class="row">

        <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">

            <div class="widget am-cf">

                <div class="widget-head am-cf">

                    <div class="widget-title  am-cf"><?php echo $name;?></div>

                </div>

                <div class="widget-body  am-fr">

                    <div class="am-u-sm-12 am-u-md-6 am-u-lg-6">

                        <div class="am-form-group">

                            <div class="am-btn-toolbar">

                                <div class="am-btn-group am-btn-group-xs">

                                    <button type="button" class="am-btn am-btn-default am-btn-success" data-am-modal="{target: '#add'}"><span class="am-icon-plus"></span> 新增</button>

                                    
                                </div>

                            </div>

                            

                        </div>

                    </div>

                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-6">

                     <form action="<?php echo site_url('module/LocalLife/search')?>" method="post">

                        <div class="am-input-group am-input-group-sm tpl-form-border-form cl-p">

                            <input type="text" name='sear' class="am-form-field" placeholder="名称/联系人/联系号码" required>

                            <input type="hidden" name='typeid' value="<?php echo $typeid;?>">

                            <input type="hidden" name='cate' value="<?php echo $id;?>">

                            <span class="am-input-group-btn">

                                <button class="am-btn  am-btn-default am-btn-success tpl-table-list-field am-icon-search" type="submit"></button>

                            </span>

                          

                        </div>

                          </form>

                    </div>

                    <div class="am-modal am-modal-confirm" tabindex="-1" id="add">

                        <div class="am-modal-dialog">

                            <div class="am-modal-hd">新增</div>

                            <div class="am-modal-bd">

                                <!-- 本地生活 信息展示类 -->

                                <form class="am-form tpl-form-line-form" enctype="multipart/form-data" data-am-validator action='<?php echo site_url('module/LocalLife/add_service')?>' method='post' enctype='multipart/form-data'>

                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">名称 <span class="red">*</span></label>

                                        <div class="am-u-sm-8">

											<input type='hidden' name='type_name' value="<?php echo $id;?>" />	

                                            <input type="text" placeholder="请输入标题,2-50个字符" name='name' minlength="2" maxlength="50" required onblur="validate(this,2,15,1)">

                                        </div>

                                        <small class="am-u-sm-1 red redtips1" style="display: none;"><i class="am-icon-close"></i></small>

                                        <small class="am-u-sm-1 green blacktips1" style="display: none;"><i class="am-icon-check"></i></small>

                                    </div>
                                    <?php if($_SESSION['city'] == '0'):?>
                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">所属城市 <span class="red">*</span></label>

                                        <div class="am-u-sm-8">
                                            <select name="city" id="">
                                                <option value="">请选择一项</option>
                                                <option value="1">重庆</option>
                                                <option value="2">南江</option>
                                                <option value="3">宣汉</option>
                                                <option value="4">邻水</option>
                                            </select>


                                        </div>

                                        <small class="am-u-sm-1 red redtips1" style="display: none;"><i class="am-icon-close"></i></small>

                                        <small class="am-u-sm-1 green blacktips1" style="display: none;"><i class="am-icon-check"></i></small>

                                    </div>

                                    <?php endif;?>

                                 

                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">服务内容 <span class="red">*</span></label>

                                        <div class="am-u-sm-8">

                                            <textarea rows='4' type="text"  name='content' required ></textarea>

                                        </div>

                                        <small class="am-u-sm-1 red redtips2" style="display: none;"><i class="am-icon-close"></i></small>

                                        <small class="am-u-sm-1 green blacktips2" style="display: none;"><i class="am-icon-check"></i></small>

                                    </div>

                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">评分 <span class="red">*</span></label>

                                        <div class="am-u-sm-8">

                                            <input type="number" onblur="validate1(this,0,1,3)" placeholder="请输入评分,1-5之间的数字" name='star' min="1" max="5" minlength="0" maxlength="1" required>

                                        </div>

                                        <small class="am-u-sm-1 red redtips3" style="display: none;"><i class="am-icon-close"></i></small>

                                        <small class="am-u-sm-1 green blacktips3" style="display: none;"><i class="am-icon-check"></i></small>

                                    </div> 

                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">服务范围 <span class="red">*</span></label>

                                        <div class="am-u-sm-8">

                                            <input type="text" onblur="validate(this,2,40,4)" placeholder="如：邻水xxxx街道,2-40个字符" minlength="2" maxlength="40" name='service_cope' required>

                                        </div>

                                        <small class="am-u-sm-1 red redtips4" style="display: none;"><i class="am-icon-close"></i></small>

                                        <small class="am-u-sm-1 green blacktips4" style="display: none;"><i class="am-icon-check"></i></small>

                                    </div>

                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">营业时间 <span class="red">*</span></label>

                                        <div class="am-u-sm-8">

                                            <input type="text" placeholder="例如：8:00-18:00" onblur="validate(this,2,15,5)" name='open_time' required minlength="2" maxlength="15">

                                        </div>

                                        <small class="am-u-sm-1 red redtips5" style="display: none;"><i class="am-icon-close"></i></small>

                                        <small class="am-u-sm-1 green blacktips5" style="display: none;"><i class="am-icon-check"></i></small>

                                    </div>
                                   


                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">联系人 <span class="red">*</span></label>

                                        <div class="am-u-sm-8">

                                            <input type="text" placeholder="请输入联系人，2-10个字符" onblur="validate(this,2,10,6)" maxlength="10" minlength="2" name='link_man' required>

                                        </div>

                                        <small class="am-u-sm-1 red redtips6" style="display: none;"><i class="am-icon-close"></i></small>

                                        <small class="am-u-sm-1 green blacktips6" style="display: none;"><i class="am-icon-check"></i></small>

                                    </div>

                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">联系电话 <span class="red">*</span></label>

                                        <div class="am-u-sm-8">

                                            <input type="tel" name="phone" onblur="validate(this,11,12,7)" class="js-pattern-mobile" placeholder="输入合法的手机号" minlength="11" maxlength="12" required>

                                        </div>

                                        <small class="am-u-sm-1 red redtips7" style="display: none;"><i class="am-icon-close"></i></small>

                                        <small class="am-u-sm-1 green blacktips7" style="display: none;"><i class="am-icon-check"></i></small>

                                    </div>

                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">详细地址 <span class="red">*</span></label>

                                        <div class="am-u-sm-8">

                                            <input type="text" name='address' required placeholder="请输入详细地址，2-50个字符" onblur="validate(this,2,50,8)" minlength="2" maxlength="50">

                                        </div>

                                        <small class="am-u-sm-1 red redtips8" style="display: none;"><i class="am-icon-close"></i></small>

                                        <small class="am-u-sm-1 green blacktips8" style="display: none;"><i class="am-icon-check"></i></small>

                                    </div>

                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">详情banner图 <span class="red">*</span></label>

                                        <div class="am-u-sm-9 am-u-end">

                                            <div class="wx_type_img">

                                             <input type="file" id="imgUpload" name="img1" onchange="previewImage(this)" class="upload-add am-form-field" multiple="multiple" required>

                                              <!-- 图片实时预览 -->

                                              <div id="preview"> <img style="border-radius: 3px;" src="assets/img/nullImg.jpg" class="am-img-responsive cardView"> </div>

                                              <span class="clickUp">banner1</span>

                                            </div>

                                            <span class="deleteImg"><i class="am-icon-trash"></i> 删除</span> 

                                            <small class="tpl-form-line-small-title red">提示：图片格式支持：png、jpg、jpeg、gif，图片大小不超过800kb;</small>

                                        </div>

                                        <div class="am-u-sm-9 am-fr">

                                            <div class="wx_type_img">

                                             <input type="file" id="imgUpload" name="img2" onchange="previewImage(this)" class="upload-add" multiple="multiple">

                                              <!-- 图片实时预览 -->

                                              <div id="preview"> <img style="border-radius: 3px;" src="assets/img/nullImg.jpg" class="am-img-responsive cardView"> </div>

                                              <span class="clickUp">banner2</span>

                                            </div>

                                            <span class="deleteImg"><i class="am-icon-trash"></i> 删除</span>

                                            <small class="tpl-form-line-small-title red">提示：图片格式支持：png、jpg、jpeg、gif，图片大小不超过800kb;</small> 

                                        </div>

                                        <div class="am-u-sm-9 am-fr">

                                            <div class="wx_type_img">

                                             <input type="file" id="imgUpload" name="img3" onchange="previewImage(this)" class="upload-add" multiple="multiple">

                                              <!-- 图片实时预览 -->

                                              <div id="preview"> <img style="border-radius: 3px;" src="assets/img/nullImg.jpg" class="am-img-responsive cardView"> </div>

                                              <span class="clickUp">banner3</span>

                                            </div>

                                            <span class="deleteImg"><i class="am-icon-trash"></i> 删除</span> 

                                            <small class="tpl-form-line-small-title red">提示：图片格式支持：png、jpg、jpeg、gif，图片大小不超过800kb;</small>

                                        </div>

                                    </div>

                                    <div class="am-form-group am-cf">

                                        <label for="" class="am-u-sm-3 am-form-label">缩略图 <span class="red">*</span></label>

                                         <div class="am-u-sm-8 am-u-end">

                                            <div class="wx_type_img">

                                             <input type="file" id="imgUpload" name="img4" onchange="previewImage(this)" class="upload-add am-form-field"  required>

                                              <!-- 图片实时预览 -->

                                              <div id="preview"> <img style="border-radius: 3px;" src="assets/img/nullImg.jpg" class="am-img-responsive cardView"> </div>

                                              <span class="clickUp">缩略图</span>

                                            </div>

                                            <span class="deleteImg"><i class="am-icon-trash"></i> 删除</span> 

                                            <small class="tpl-form-line-small-title red">提示：图片格式支持：png、jpg、jpeg、gif，图片大小不超过800kb;</small>

                                        </div>

                                    </div>

                                    <div class="am-form-group am-cf">

                                        <label class="am-u-sm-3 am-form-label">发布人身份<span class="red">*</span></label>

                                        <div class="am-u-sm-3">

                                            <input type="radio" class="am-inline" name='isbusiness' value='1'>商家

                                        </div>

                                        <div class="am-u-sm-3 am-u-end">

                                            <input type="radio" class="am-inline" name='isbusiness' value="0" >个人

                                        </div>

                                    </div>

                                    <div class="am-form-group am-btn-group-xs">

                                        <button type="button" class="am-btn am-btn-default" data-am-modal-close>取消</button>

                                        <button type="submit" class="am-btn am-btn-danger">提交</button>

                                    </div>

                                </form>

                            </div>

                        </div>

                    </div>

                    <div class="am-u-sm-12 am-u-xs-12">

                        <table width="100%" class="am-table am-table-compact am-text-nowrap tpl-table-black ">

                            <thead>

                                <tr>

                                    <th>编号</th>
                                    <th>所属城市</th>

                                    <th>名称</th>

                                    <th>缩略图</th>

                                    <th>联系人</th>

                                    <th>联系号码</th>

                                    <th>评分</th>

                                    <th>发布人身份</th>

                                    <th>创建时间</th>

                                    <th>操作</th>

                                </tr>

                            </thead>

                            <tbody>

								<?php if(!empty($lists)){?>

								<?php foreach($lists as $key=>$val):?>

                                <tr>

                                    <td class="am-text-middle"><?php echo $val['id'];?></td>
                                    <td  class="am-text-middle">
                                        <?php switch ($val['city']) {
                                            case '1':
                                               echo "重庆";
                                                break;
                                                case '2':
                                               echo "南江";
                                                break;
                                                case '3':
                                               echo "宣汉";
                                                break;
                                                case '4':
                                               echo "邻水";
                                                break;
                                        }?>
                                    </td>


                                    <td class="am-text-middle"><?php echo $val['name']?></td>

                                    <?php $logo = json_decode($val['logo'],true);?>

                                    <td ><img style='width:100px;' src='<?php echo $logo[0]['picImg'];?>' alt='<?php echo $val['name']?>'/></td>

                                    <td class="am-text-middle"><?php echo $val['link_man'];?></td>

                                    <td class="am-text-middle"><?php echo $val['phone'];?></td>

                                    <td class="am-text-middle"><?php echo $val['star']?></td>

                                    <td class="am-text-middle"><?php if($val['isbusiness'] == '1'){echo "商家";}else{echo "个人";}?></td>

                                    <td class="am-text-middle"><?php echo $val['create_time']?></td>

                                    <td class="am-text-middle">

                                        <div class="tpl-table-black-operation">

                                            
<!-- 
                                            <?php if($val['iscommend'] == '1'):?>

                                            <a data-id="<?php echo $val['id'];?>" dataId="<?php echo $val['iscommend']?>" class="isRecommand gray">

                                                <i class="am-icon-star-o"></i> 不推荐

                                            </a>

                                            <?php else:?>

                                            <a data-id="<?php echo $val['id'];?>" dataId="<?php echo $val['iscommend']?>" class="isRecommand">

                                                <i class="am-icon-star"></i> 推荐到本地生活首页

                                            </a>

                                            <?php endif;?> -->

                                            <a href="<?php echo site_url().'/module/LocalLife/serviceInfo/'.$val['id'].'/'.$typeid.'/'.$id;?>" class="">

                                                <i class="am-icon-pencil"></i> 编辑

                                            </a>

                                            <a href="<?php echo site_url('/module/LocalLife/del_service/'.$val['id'].'/'.$typeid.'/'.$id);?>" onclick="return confirm('确定删除?');" class="tpl-table-black-operation-del" >

                                                <i class="am-icon-trash"></i> 删除

                                            </a>

                                        </div>

                                    </td>

                                </tr>

                            
								<?php endforeach;?>

								<?php }else{?>

								<th colspan='9' style='text-align:center;'>暂无内容！</th>

								<?php }?>

                                <!-- more data -->

                            </tbody>

                        </table>

                    </div>

                    <div class="am-u-lg-12 am-text-center am-cf">

                        <div class="">

                           <?php echo $pages;?>

                        </div>

                    </div>

                </div>

            </div>

        </div>

    </div>




    <?php }?>





</div>

</div>

<script type="text/javascript">

    //表单验证函数

    function validate(obj,minlen,maxlen,i){

        var content=obj.value;

        if(content.length<minlen || content.length>maxlen){

            $('.blacktips'+ i).css('display','none');

            $('.redtips'+ i).css('display','inline-block');

        }else{

            $('.redtips'+ i).css('display','none');

            $('.blacktips'+ i).css('display','inline-block');

        }

    }

    function validate1(obj,minlen,maxlen,i){

        var content=obj.value;

        if(content.length<minlen || content.length>maxlen || parseInt(content)>5 || parseInt(content)<1){

            $('.blacktips'+ i).css('display','none');

            $('.redtips'+ i).css('display','inline-block');

        }else{

            $('.redtips'+ i).css('display','none');

            $('.blacktips'+ i).css('display','inline-block');

        }

    }



    function uploadFiles(){

        var fileObj=document.getElementsByClassName('fileUpLoad')[0].files[0];//获取文件对象

       // console.log(fileObj.name.split('.')[1]);

        var FileController="<?php echo site_url('/module/LocalLife/send_market_data');?>";//上传文件的后台地址

        if(fileObj.name.split('.')[1]=='xml' || fileObj.name.split('.')[1]=='xlsx'){

           var form=new FormData();

            form.append('file',fileObj); //文件对象

            //实例化XMLHttpRequest对象

            var xhr=new XMLHttpRequest();

            xhr.open('post',FileController,true);

            xhr.onload=function(){

                alert("导入成功！");

                location.reload();

            

            };

            xhr.send(form); 

            return true;

        }else{

            alert("上传文件的格式错误！");

            return false;

        }

        

    }



    $(document).ready(function () {

        //推荐到本地生活首页

        $('.isRecommand').click(function(){

            var dataId = $(this).attr('data-id'), iscommend = $(this).attr('dataId');

            if(iscommend == "0") {

                iscommend = 1;

            } else {

                iscommend = 0;

            }

            // console.log('id='+ dataId + '&iscommend='+ iscommend);

            $.ajax({ 

                type:'post',

                url: "<?php echo site_url('/module/LocalLife/service_recommend');?>",

                data: 'id='+ dataId + '&iscommend='+ iscommend,

                success: function(result){    

                    console.log(result);     

                    var res = eval(result);

                    if(res == 1){

                        alert("设置成功！");

                        window.location.reload();

                    }else{

                       alert("网络状况不佳，请稍后重试！");

                    }

                    

                },

                error:function(xhr,type,errorThrown){

                    alert("网络状况不佳，请稍后重试！");

                }

            });

        });

        $('.isRecommand1').click(function(){

            var dataId = $(this).attr('data-id'), iscommend = $(this).attr('dataId');

            if(iscommend == "0") {

                iscommend = 1;

            } else {

                iscommend = 0;

            }

            console.log('id='+ dataId + '&iscommend='+ iscommend);

            $.ajax({ 

                type:'post',

                url: "<?php echo site_url('/module/LocalLife/house_recommend');?>",

                data: 'id='+ dataId + '&recommend_state='+ iscommend,

                success: function(result){    

                    console.log(result);     

                    var res = eval(result);

                    if(res == 1){

                        alert("设置成功！");

                        window.location.reload();

                    }else{

                       alert("网络状况不佳，请稍后重试！");

                    }

                    

                },

                error:function(xhr,type,errorThrown){

                    alert("网络状况不佳，请稍后重试！");

                }

            });

        });

        $('.isRecommand2').click(function(){

            var dataId = $(this).attr('data-id'), iscommend = $(this).attr('dataId');

            if(iscommend == "0") {

                iscommend = 1;

            } else {

                iscommend = 0;

            }

            console.log('id='+ dataId + '&iscommend='+ iscommend);

            $.ajax({ 

                type:'post',

                url: "<?php echo site_url('/module/LocalLife/market_recommend');?>",

                data: 'id='+ dataId + '&recommend_state='+ iscommend,

                success: function(result){    

                    console.log(result);     

                    var res = eval(result);

                    if(res == 1){

                        alert("设置成功！");

                        window.location.reload();

                    }else{

                       alert("网络状况不佳，请稍后重试！");

                    }

                    

                },

                error:function(xhr,type,errorThrown){

                    alert("网络状况不佳，请稍后重试！");

                }

            });

        });

    })

    //删除图片

    $(".deleteImg").click(function(){      

        $(this).prevUntil('.preview').find('img').attr('src','assets/img/nullImg.jpg');

        $(this).prevUntil('.preview').find('input').val("");

    });

</script>

</body>

</html>



